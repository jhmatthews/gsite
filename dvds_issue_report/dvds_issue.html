<!DOCTYPE html>
<!-- saved from url=(0045)https://github.com/agnwinds/python/issues/118 -->
<html lang="en" class=""><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>Line profiles change with viewing angle for a spherical wind model in spherical coordinates · Issue #118 · agnwinds/python</title>
    <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://github.com/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://github.com/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site"><meta content="summary" name="twitter:card"><meta content="agnwinds/python" name="twitter:title"><meta content="python - This is the repository for Python, the radiative transfer code used to model AGN winds." name="twitter:description"><meta content="https://avatars0.githubusercontent.com/u/3064657?v=3&amp;s=400" name="twitter:image:src">
<meta content="GitHub" property="og:site_name"><meta content="object" property="og:type"><meta content="https://avatars0.githubusercontent.com/u/3064657?v=3&amp;s=400" property="og:image"><meta content="agnwinds/python" property="og:title"><meta content="https://github.com/agnwinds/python" property="og:url"><meta content="python - This is the repository for Python, the radiative transfer code used to model AGN winds." property="og:description">

      <meta name="browser-stats-url" content="/_stats">
    <link rel="assets" href="https://assets-cdn.github.com/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="https://github.com/_sockets">
    <meta name="pjax-timeout" content="1000">
    <link rel="sudo-modal" href="https://github.com/sessions/sudo_modal">

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host"><meta content="collector-cdn.github.com" name="octolytics-script-host"><meta content="github" name="octolytics-app-id"><meta content="984E24F5:6BA6:8232A79:5463D762" name="octolytics-dimension-request_id"><meta content="3007249" name="octolytics-actor-id"><meta content="jhmatthews" name="octolytics-actor-login"><meta content="498d9196868881e615f7867129bb2342967782042bbd7164c75690393fa6c4e0" name="octolytics-actor-hash">
    
    <meta content="Rails, view, files#disambiguate" name="analytics-event">

    
    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param">
<meta content="QnAl+zL1Q+2mFfAonl4hdDSn97Z0u8TRfsVt+zbTcbe8+SH/KxXnZ3iHOQuUl3qDbfsmmH84VGqR7j/3fqASkQ==" name="csrf-token">

    <link href="./dvds_issue_files/github-1a2396c5eb371559f3a159e677a975bf1ac09b0d78f822f66a7b9158abaa8607.css" media="all" rel="stylesheet" type="text/css">
    <link href="./dvds_issue_files/github2-ff34ef52da60232828853c6784bb93c166f9559d854b8ae2e71598ba617af5a1.css" media="all" rel="stylesheet" type="text/css">
    
    


    <meta http-equiv="x-pjax-version" content="b9f2ece2689e8381fcc9b7277703d0f8">

      
  <meta name="description" content="python - This is the repository for Python, the radiative transfer code used to model AGN winds.">
  <meta name="go-import" content="github.com/agnwinds/python git https://github.com/agnwinds/python.git">

  <meta content="3064657" name="octolytics-dimension-user_id"><meta content="agnwinds" name="octolytics-dimension-user_login"><meta content="7667591" name="octolytics-dimension-repository_id"><meta content="agnwinds/python" name="octolytics-dimension-repository_nwo"><meta content="true" name="octolytics-dimension-repository_public"><meta content="false" name="octolytics-dimension-repository_is_fork"><meta content="7667591" name="octolytics-dimension-repository_network_root_id"><meta content="agnwinds/python" name="octolytics-dimension-repository_network_root_nwo">
  <link href="https://github.com/agnwinds/python/commits/dev.atom" rel="alternate" title="Recent Commits to python:dev" type="application/atom+xml">

  <script type="text/javascript" async="" src="./dvds_issue_files/api.js"></script><meta name="selected-link" value="repo_issues" data-pjax-transient="true"><meta content="Rails, view, issues#show" name="analytics-event" data-pjax-transient="true"></head>


  <body class="logged_in  env-production macintosh vis-public">
    <a href="https://github.com/agnwinds/python/issues/118#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      
      


      <div class="header header-logged-in true" role="banner">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" ga-data-click="Header, go to dashboard, icon:logo">
  <span class="mega-octicon octicon-mark-github"></span>
</a>


      <div class="site-search repo-scope js-site-search" role="search">
          <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/agnwinds/python/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"></div>
  <input type="text" class="js-site-search-field is-clearable" data-hotkey="s" name="q" placeholder="Search" data-global-scope-placeholder="Search GitHub" data-repo-scope-placeholder="Search" tabindex="1" autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
      </div>
      <ul class="header-nav left" role="navigation">
        <li class="header-nav-item explore">
          <a class="header-nav-link" href="https://github.com/explore" data-ga-click="Header, go to explore, text:explore">Explore</a>
        </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://gist.github.com/" data-ga-click="Header, go to gist, text:gist">Gist</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://github.com/blog" data-ga-click="Header, go to blog, text:blog">Blog</a>
          </li>
        <li class="header-nav-item">
          <a class="header-nav-link" href="https://help.github.com/" data-ga-click="Header, go to help, text:help">Help</a>
        </li>
      </ul>

    
<ul class="header-nav user-nav right" id="user-links">
  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link name" href="https://github.com/jhmatthews" data-ga-click="Header, go to profile, text:username">
      <img alt="James Matthews" class="avatar" data-user="3007249" height="20" src="./dvds_issue_files/3007249" width="20">
      <span class="css-truncate">
        <span class="css-truncate-target">jhmatthews</span>
      </span>
    </a>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link js-menu-target tooltipped tooltipped-s" href="https://github.com/agnwinds/python/issues/118#" aria-label="Create new..." data-ga-click="Header, create new, icon:add">
      <span class="octicon octicon-plus"></span>
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      
<ul class="dropdown-menu">
  <li>
    <a href="https://github.com/new"><span class="octicon octicon-repo"></span> New repository</a>
  </li>
  <li>
    <a href="https://github.com/organizations/new"><span class="octicon octicon-organization"></span> New organization</a>
  </li>


    <li class="dropdown-divider"></li>
    <li class="dropdown-header">
      <span title="agnwinds/python">This repository</span>
    </li>
      <li>
        <a href="https://github.com/agnwinds/python/issues/new"><span class="octicon octicon-issue-opened"></span> New issue</a>
      </li>
</ul>

    </div>
  </li>

  <li class="header-nav-item">
        <a href="https://github.com/notifications" aria-label="You have unread notifications" class="header-nav-link notification-indicator tooltipped tooltipped-s" data-ga-click="Header, go to notifications, icon:unread" data-hotkey="g n">
        <span class="mail-status unread"></span>
        <span class="octicon octicon-inbox"></span>
</a>
  </li>

  <li class="header-nav-item">
    <a class="header-nav-link tooltipped tooltipped-s" href="https://github.com/settings/profile" id="account_settings" aria-label="Settings" data-ga-click="Header, go to settings, icon:settings">
      <span class="octicon octicon-gear"></span>
    </a>
  </li>

  <li class="header-nav-item">
    <form accept-charset="UTF-8" action="https://github.com/logout" class="logout-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="fsQu6JioFdgFp788/2fhKkGBrDmCuamfSW0tl6lnph3LVWrv/0/5fwUKY4nnngm3yAx7taqyAcr6p8RhmKMDmg=="></div>
      <button class="header-nav-link sign-out-button tooltipped tooltipped-s" aria-label="Sign out" data-ga-click="Header, sign out, icon:logout">
        <span class="octicon octicon-sign-out"></span>
      </button>
</form>  </li>

</ul>


    
  </div>
</div>

      

        


      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope="" itemtype="http://schema.org/WebPage">
    <div id="js-flash-container"><div id="pjax-flash">
  
</div></div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">

    <li class="subscription">
      <form accept-charset="UTF-8" action="https://github.com/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="ntIIFpQgd55MfHxn/4oLe0k4CLFEGQH7dC1xZ4Y+NrPMVNxq1kZFeMYbDgJ2Xut40g3+CYo54Ou6xj2g50DHow=="></div>  <input id="repository_id" name="repository_id" type="hidden" value="7667591">

    <div class="select-menu js-menu-container js-select-menu">
      <a class="social-count js-social-count" href="https://github.com/agnwinds/python/watchers">
        5
      </a>
      <a href="https://github.com/agnwinds/python/subscription" class="minibutton select-menu-button with-count js-menu-target" role="button" tabindex="0" aria-haspopup="true">
        <span class="js-select-button">
          <span class="octicon octicon-eye"></span>
          Unwatch
        </span>
      </a>

      <div class="select-menu-modal-holder">
        <div class="select-menu-modal subscription-menu-modal js-menu-content" aria-hidden="true">
          <div class="select-menu-header">
            <span class="select-menu-title">Notifications</span>
            <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
          </div> <!-- /.select-menu-header -->

          <div class="select-menu-list js-navigation-container" role="menu">

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_included" name="do" type="radio" value="included">
                <h4>Not watching</h4>
                <span class="description">Be notified when participating or @mentioned.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye"></span>
                  Watch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input checked="checked" id="do_subscribed" name="do" type="radio" value="subscribed">
                <h4>Watching</h4>
                <span class="description">Be notified of all conversations.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye"></span>
                  Unwatch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_ignore" name="do" type="radio" value="ignore">
                <h4>Ignoring</h4>
                <span class="description">Never be notified.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-mute"></span>
                  Stop ignoring
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

          </div> <!-- /.select-menu-list -->

        </div> <!-- /.select-menu-modal -->
      </div> <!-- /.select-menu-modal-holder -->
    </div> <!-- /.select-menu -->

</form>
    </li>

  <li>
    
  <div class="js-toggler-container js-social-container starring-container on">

    <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/unstar" class="js-toggler-form starred js-unstar-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="XVLgaJI5OR9JUgaKM7dmjCVMGbkNuz91GshqAPfOcFTtHcBCFOcXmj7dGdgr7M/RQqhQOUqSHdlpdvjCtAFntQ=="></div>
      <button class="minibutton with-count js-toggler-target star-button" aria-label="Unstar this repository" title="Unstar agnwinds/python">
        <span class="octicon octicon-star"></span>
        Unstar
      </button>
        <a class="social-count js-social-count" href="https://github.com/agnwinds/python/stargazers">
          2
        </a>
</form>
    <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/star" class="js-toggler-form unstarred js-star-button" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="bP4iOIf+llJk6AEUkwAJtLLPwBoBiQpfuqLUYiw8wVSprEnj9+oAwA2rc5YaBBYokOn2uHw6wr7QJBKYeMgn6Q=="></div>
      <button class="minibutton with-count js-toggler-target star-button" aria-label="Star this repository" title="Star agnwinds/python">
        <span class="octicon octicon-star"></span>
        Star
      </button>
        <a class="social-count js-social-count" href="https://github.com/agnwinds/python/stargazers">
          2
        </a>
</form>  </div>

  </li>


        <li>
          <a href="https://github.com/agnwinds/python/fork" class="minibutton with-count js-toggler-target fork-button tooltipped-n" title="Fork your own copy of agnwinds/python to your account" aria-label="Fork your own copy of agnwinds/python to your account" rel="nofollow" data-method="post">
            <span class="octicon octicon-repo-forked"></span>
            Fork
          </a>
          <a href="https://github.com/agnwinds/python/network" class="social-count">3</a>
        </li>

</ul>

        <h1 itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="https://github.com/agnwinds" class="url fn" itemprop="url" rel="author"><span itemprop="title">agnwinds</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="https://github.com/agnwinds/python" class="js-current-repository" data-pjax="#js-repo-pjax-container">python</a></strong>

          <span class="page-context-loader">
            <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline">
        <div class="repository-sidebar clearfix">
            
<nav class="sunken-menu repo-nav js-repo-nav js-sidenav-container-pjax js-octicon-loaders" role="navigation" data-pjax="#js-repo-pjax-container" data-issue-count-url="/agnwinds/python/issues/counts">
  <ul class="sunken-menu-group">
    <li class="tooltipped tooltipped-w" aria-label="Code">
      <a href="https://github.com/agnwinds/python" aria-label="Code" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /agnwinds/python">
        <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
        <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Issues">
        <a href="https://github.com/agnwinds/python/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item selected" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /agnwinds/python/issues">
          <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
          <span class="counter">14</span>

          <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>      </li>

    <li class="tooltipped tooltipped-w" aria-label="Pull Requests">
      <a href="https://github.com/agnwinds/python/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g p" data-selected-links="repo_pulls /agnwinds/python/pulls">
          <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
          <span class="counter">0</span>

          <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>    </li>


      <li class="tooltipped tooltipped-w" aria-label="Wiki">
        <a href="https://github.com/agnwinds/python/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g w" data-selected-links="repo_wiki /agnwinds/python/wiki">
          <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
          <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>      </li>
  </ul>
  <div class="sunken-menu-separator"></div>
  <ul class="sunken-menu-group">

    <li class="tooltipped tooltipped-w" aria-label="Pulse">
      <a href="https://github.com/agnwinds/python/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-selected-links="pulse /agnwinds/python/pulse">
        <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
        <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>    </li>

    <li class="tooltipped tooltipped-w" aria-label="Graphs">
      <a href="https://github.com/agnwinds/python/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-selected-links="repo_graphs repo_contributors /agnwinds/python/graphs">
        <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
        <img alt="" class="mini-loader" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16">
</a>    </li>
  </ul>


</nav>

              <div class="only-with-full-nav">
                
  
<div class="clone-url open" data-protocol-type="http" data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=push">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="https://github.com/agnwinds/python.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/agnwinds/python.git" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url " data-protocol-type="ssh" data-url="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=push">
  <h3><span class="text-emphasized">SSH</span> clone URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="git@github.com:agnwinds/python.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="git@github.com:agnwinds/python.git" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url " data-protocol-type="subversion" data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=push">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group">
    <input type="text" class="input-mini input-monospace js-url-field" value="https://github.com/agnwinds/python" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://github.com/agnwinds/python" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="https://github.com/agnwinds/python/issues/118#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
      <a href="https://github.com/agnwinds/python/issues/118#" class="js-clone-selector" data-protocol="ssh">SSH</a>,
      or <a href="https://github.com/agnwinds/python/issues/118#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>

  <a href="http://mac.github.com/" data-url="github-mac://openRepo/https://github.com/agnwinds/python" class="minibutton sidebar-button js-conduit-rewrite-url" title="Save agnwinds/python to your computer and use it in GitHub Desktop." aria-label="Save agnwinds/python to your computer and use it in GitHub Desktop.">
    <span class="octicon octicon-device-desktop"></span>
    Clone in Desktop
  </a>


                <a href="https://github.com/agnwinds/python/archive/dev.zip" class="minibutton sidebar-button" aria-label="Download the contents of agnwinds/python as a zip file" title="Download the contents of agnwinds/python as a zip file" rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container="">
    
<style type="text/css" media="screen">
  span.labelstyle-f7c6c7, .linked-labelstyle-f7c6c7 {  background-color: #f7c6c7 !important;  color: #332829 !important;}.labelstyle-f7c6c7.selected {  background-color: #f7c6c7 !important;  color: #332829 !important;}.label-select-menu .labelstyle-f7c6c7.selected {  background:rgba(247, 198, 199, 0.12) !important;  color: #997a7b !important;}

span.labelstyle-fbca04, .linked-labelstyle-fbca04 {  background-color: #fbca04 !important;  color: #332900 !important;}.labelstyle-fbca04.selected {  background-color: #fbca04 !important;  color: #332900 !important;}.label-select-menu .labelstyle-fbca04.selected {  background:rgba(251, 202, 4, 0.12) !important;  color: #997b02 !important;}

span.labelstyle-207de5, .linked-labelstyle-207de5 {  background-color: #207de5 !important;  color: #fff !important;}.labelstyle-207de5.selected {  background-color: #207de5 !important;  color: #fff !important;}.label-select-menu .labelstyle-207de5.selected {  background:rgba(32, 125, 229, 0.12) !important;  color: #155399 !important;}

span.labelstyle-bfe5bf, .linked-labelstyle-bfe5bf {  background-color: #bfe5bf !important;  color: #2a332a !important;}.labelstyle-bfe5bf.selected {  background-color: #bfe5bf !important;  color: #2a332a !important;}.label-select-menu .labelstyle-bfe5bf.selected {  background:rgba(191, 229, 191, 0.12) !important;  color: #7f997f !important;}

span.labelstyle-cccccc, .linked-labelstyle-cccccc {  background-color: #cccccc !important;  color: #333333 !important;}.labelstyle-cccccc.selected {  background-color: #cccccc !important;  color: #333333 !important;}.label-select-menu .labelstyle-cccccc.selected {  background:rgba(204, 204, 204, 0.12) !important;  color: #999999 !important;}

span.labelstyle-84b6eb, .linked-labelstyle-84b6eb {  background-color: #84b6eb !important;  color: #1c2733 !important;}.labelstyle-84b6eb.selected {  background-color: #84b6eb !important;  color: #1c2733 !important;}.label-select-menu .labelstyle-84b6eb.selected {  background:rgba(132, 182, 235, 0.12) !important;  color: #557699 !important;}

span.labelstyle-eb6420, .linked-labelstyle-eb6420 {  background-color: #eb6420 !important;  color: #fff !important;}.labelstyle-eb6420.selected {  background-color: #eb6420 !important;  color: #fff !important;}.label-select-menu .labelstyle-eb6420.selected {  background:rgba(235, 100, 32, 0.12) !important;  color: #994114 !important;}

span.labelstyle-009800, .linked-labelstyle-009800 {  background-color: #009800 !important;  color: #fff !important;}.labelstyle-009800.selected {  background-color: #009800 !important;  color: #fff !important;}.label-select-menu .labelstyle-009800.selected {  background:rgba(0, 152, 0, 0.12) !important;  color: #009900 !important;}

span.labelstyle-006b75, .linked-labelstyle-006b75 {  background-color: #006b75 !important;  color: #fff !important;}.labelstyle-006b75.selected {  background-color: #006b75 !important;  color: #fff !important;}.label-select-menu .labelstyle-006b75.selected {  background:rgba(0, 107, 117, 0.12) !important;  color: #008b99 !important;}

span.labelstyle-cc317c, .linked-labelstyle-cc317c {  background-color: #cc317c !important;  color: #fff !important;}.labelstyle-cc317c.selected {  background-color: #cc317c !important;  color: #fff !important;}.label-select-menu .labelstyle-cc317c.selected {  background:rgba(204, 49, 124, 0.12) !important;  color: #99245c !important;}

span.labelstyle-e11d21, .linked-labelstyle-e11d21 {  background-color: #e11d21 !important;  color: #fff !important;}.labelstyle-e11d21.selected {  background-color: #e11d21 !important;  color: #fff !important;}.label-select-menu .labelstyle-e11d21.selected {  background:rgba(225, 29, 33, 0.12) !important;  color: #991316 !important;}
</style>

<div class="issues-listing" data-pjax="">
  <div class="context-loader large-format-loader">
  <p><img alt="" height="64" src="./dvds_issue_files/octocat-spinner-128.gif" width="64"></p>
  <p>Loading…</p>
</div>

    <div id="show_issue" class="js-issues-results">

    
  <div id="partial-discussion-header" class="gh-header js-details-container js-socket-channel js-updatable-content issue" data-channel="agnwinds/python:issue:44679748" data-url="/agnwinds/python/issues/118/show_partial?partial=title">

  <div class="gh-header-show ">
    <div class="gh-header-actions">
        <button type="button" class="minibutton js-details-target">Edit</button>

        <a href="https://github.com/agnwinds/python/issues/new" class="minibutton primary" data-hotkey="c">
          New issue
        </a>
    </div>

    <h1 class="gh-header-title">
      <span class="js-issue-title">Line profiles change with viewing angle for a spherical wind model in spherical coordinates</span>
      <span class="gh-header-number">#118</span>
    </h1>
  </div>

    <div class="gh-header-edit">
      <form accept-charset="UTF-8" action="./dvds_issue_files/dvds_issue.html" class="js-issue-update js-comment" data-remote="true" data-type="json" id="edit_header_44679748" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="M3I3oFG2c0sjqanFjRFBFNDlqZvlvSm8LWcj5pqAQuhAOzFQXhiDlgBzUNNeUPFalo9MjYW3MmMW++gOQPUyyA=="></div>
        <input class="edit-issue-title" id="issue_title" name="issue[title]" size="30" tabindex="1" type="text" value="Line profiles change with viewing angle for a spherical wind model in spherical coordinates">
        <button class="button" type="submit" data-disable-with="Updating" tabindex="1">Save</button>
        <button class="button-link js-details-target" type="button">Cancel</button>
</form>    </div>

  <div class="flex-table gh-header-meta">
    <div class="flex-table-item">
        <div class="state state-open">
          <span class="octicon octicon-issue-opened"></span>
          Open
        </div>
    </div>
    <div class="flex-table-item flex-table-item-primary">
        <a href="https://github.com/jhmatthews" class="author">jhmatthews</a> opened this <span class="noun">Issue</span> <time datetime="2014-10-02T12:14:53Z" is="relative-time" title="Oct 2, 2014, 8:14 AM EDT">on Oct 2</time>
        · 27 comments
    </div>
  </div>
</div>


    <div id="discussion_bucket" class="tab-content clearfix">
      <div class="discussion-sidebar">
        <div id="partial-discussion-stats" class="discussion-stats js-socket-channel js-updatable-content" data-channel="agnwinds/python:issue:44679748" data-url="/agnwinds/python/issues/118/show_partial?partial=discussion_stats">
</div>

<div class="discussion-sidebar-item sidebar-labels">
  <div class="select-menu label-select-menu js-issue-show-label-select-menu js-menu-container js-select-menu" data-url="/agnwinds/python/issues/labels/modify_assignment" data-multiple="">
    <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issues/labels/modify_assignment" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="hZVqVMXM48UXj85iun+43bfdsi7J9UH+WS5Uoxy9JyyleXPl13t8Q3sRpiyacBiQn6B+A9Yx/LYg4pOZL5J0Jg=="></div>
      <div class="select-menu-modal-holder js-menu-content js-navigation-container" aria-hidden="true">

  <div class="select-menu-modal">
    <div class="select-menu-header">
      <span class="select-menu-title">Apply labels to this issue</span>
      <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
    </div>

    <div class="select-menu-filters">
      <div class="select-menu-text-filter">
        <input type="text" id="label-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter labels" autocomplete="off">
      </div>
    </div>

    <div class="select-menu-list" data-filterable-for="label-filter-field" data-filterable-type="substring">

      <div class="select-menu-item js-navigation-item labelstyle-f7c6c7 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="admin" class="color-label labelstyle-f7c6c7">
              <input style="display: none" type="checkbox" value="admin" name="labels[]">
              <span class="color" style="background-color: #f7c6c7"></span>
              <span class="name">admin</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-fbca04 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="bandaid" class="color-label labelstyle-fbca04">
              <input style="display: none" type="checkbox" value="bandaid" name="labels[]">
              <span class="color" style="background-color: #fbca04"></span>
              <span class="name">bandaid</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-207de5  selected">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="bug" class="color-label labelstyle-207de5">
              <input style="display: none" type="checkbox" value="bug" name="labels[]" checked="checked">
              <span class="color" style="background-color: #207de5"></span>
              <span class="name">bug</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-bfe5bf ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="closed with caveat" class="color-label labelstyle-bfe5bf">
              <input style="display: none" type="checkbox" value="closed with caveat" name="labels[]">
              <span class="color" style="background-color: #bfe5bf"></span>
              <span class="name">closed with caveat</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-cccccc ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="duplicate" class="color-label labelstyle-cccccc">
              <input style="display: none" type="checkbox" value="duplicate" name="labels[]">
              <span class="color" style="background-color: #cccccc"></span>
              <span class="name">duplicate</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-84b6eb ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="enhancement" class="color-label labelstyle-84b6eb">
              <input style="display: none" type="checkbox" value="enhancement" name="labels[]">
              <span class="color" style="background-color: #84b6eb"></span>
              <span class="name">enhancement</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-eb6420  selected">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="high" class="color-label labelstyle-eb6420">
              <input style="display: none" type="checkbox" value="high" name="labels[]" checked="checked">
              <span class="color" style="background-color: #eb6420"></span>
              <span class="name">high</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-009800 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="low" class="color-label labelstyle-009800">
              <input style="display: none" type="checkbox" value="low" name="labels[]">
              <span class="color" style="background-color: #009800"></span>
              <span class="name">low</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-fbca04 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="medium" class="color-label labelstyle-fbca04">
              <input style="display: none" type="checkbox" value="medium" name="labels[]">
              <span class="color" style="background-color: #fbca04"></span>
              <span class="name">medium</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-006b75 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="not-a-bug" class="color-label labelstyle-006b75">
              <input style="display: none" type="checkbox" value="not-a-bug" name="labels[]">
              <span class="color" style="background-color: #006b75"></span>
              <span class="name">not-a-bug</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-cc317c ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="question" class="color-label labelstyle-cc317c">
              <input style="display: none" type="checkbox" value="question" name="labels[]">
              <span class="color" style="background-color: #cc317c"></span>
              <span class="name">question</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="select-menu-item js-navigation-item labelstyle-e11d21 ">
        <span class="select-menu-item-icon octicon octicon-check"></span>
        <div class="select-menu-item-text">
          <div class="color-label-wrapper">
            <div data-name="urgent" class="color-label labelstyle-e11d21">
              <input style="display: none" type="checkbox" value="urgent" name="labels[]">
              <span class="color" style="background-color: #e11d21"></span>
              <span class="name">urgent</span>
              <span class="octicon octicon-x"></span>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="select-menu-no-results">Nothing to show</div>


    <div class="select-menu-loading-overlay">Loading…</div>
  </div>
</div>

      <input type="hidden" class="js-issue-number" name="issues[]" value="118">

        <button class="discussion-sidebar-heading discussion-sidebar-toggle js-menu-target" aria-label="Manage labels" aria-haspopup="true" data-hotkey="l">
          <span class="octicon octicon-gear"></span>
          Labels
        </button>
</form>  </div>

  <div class="labels css-truncate js-timeline-label-list">  <a href="https://github.com/agnwinds/python/labels/bug" class="label css-truncate-target linked-labelstyle-207de5" title="bug">bug</a>
  <a href="https://github.com/agnwinds/python/labels/high" class="label css-truncate-target linked-labelstyle-eb6420" title="high">high</a>
</div>
</div>

<div class="discussion-sidebar-item sidebar-milestone">
  <div class="select-menu js-menu-container js-select-menu js-milestone-picker is-showing-clear-item js-load-contents" data-contents-url="/agnwinds/python/issues/118/show_partial?partial=milestone_select_menu">
      <button class="discussion-sidebar-heading discussion-sidebar-toggle js-menu-target" aria-label="Set milestone" aria-haspopup="true" data-hotkey="m">
        <span class="octicon octicon-gear"></span>
        Milestone
      </button>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container" aria-hidden="true">
        <div class="select-menu-modal">
          <div class="select-menu-header">
            <span class="select-menu-title">Set milestone</span>
            <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
          </div>

          <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/milestone" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="Z4GbokBqNnqNf3opPzcz0bPi3ordlMXxg3yoaMv3ysk4dNl6TDz+FrQP21Qm+kiN7LbOUQ+FnSgEfL0lwc3Irg=="></div>
            <div class="js-milestone-picker-body">
              <div class="js-select-menu-deferred-content"></div>
              <div class="select-menu-loading-overlay">Loading…</div>
            </div>
            <input type="hidden" class="js-issue-number" name="issues[]" value="118">
</form>        </div>
      </div>
  </div>

  <span class="js-milestone-infobar-item-wrapper">
      <span class="progress-bar"><span class="progress" style="width: 57.14285714285714%">&nbsp;</span></span>
  <a title="Public Release" href="https://github.com/agnwinds/python/milestones/Public%20Release" class="milestone-name css-truncate">
    <span class="css-truncate-target">Public Release</span>
  </a>

  </span>
</div>

<div class="discussion-sidebar-item sidebar-assignee">
  <div class="select-menu js-menu-container js-select-menu js-assignee-picker is-showing-clear-item js-load-contents" data-contents-url="/agnwinds/python/issues/118/show_partial?partial=assignee_select_menu">
      <button class="discussion-sidebar-heading discussion-sidebar-toggle js-menu-target" aria-label="Assign someone to this issue" aria-haspopup="true" data-hotkey="a">
        <span class="octicon octicon-gear"></span>
        Assignee
      </button>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container" aria-hidden="true">
        <div class="select-menu-modal">
          <div class="select-menu-header">
            <span class="select-menu-title">Assign someone to this issue</span>
            <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
          </div>
          <div class="js-select-menu-deferred-content"></div>
          <div class="select-menu-loading-overlay">Loading…</div>
        </div>
      </div>
  </div>

  <span class="css-truncate js-assignee-infobar-item-wrapper">
      <img alt="James Matthews" class="avatar" data-user="3007249" height="20" src="./dvds_issue_files/3007249" width="20">
      <a href="https://github.com/agnwinds/python/issues/assigned/jhmatthews" class="assignee css-truncate-target">jhmatthews</a>
  </span>
</div>

  <div class="discussion-sidebar-item sidebar-notifications">
    <h3 class="discussion-sidebar-heading">Notifications</h3>
    <div class="thread-subscription-status js-thread-subscription-status js-socket-channel js-updatable-content" data-channel="agnwinds/python:thread-subscription:44679748:jhmatthews" data-url="/notifications/thread_subscription?repository_id=7667591&amp;thread_class=Issue&amp;thread_id=44679748">

  <span class="mega-octicon octicon-radio-tower"></span>

  <form accept-charset="UTF-8" action="https://github.com/notifications/thread" class="thread-subscribe-form" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="EcSYnwb+K1q0FOAIRD5utIBE9XzpHPHWuOktBZD2EoA3eslYsw4P+2XMNek8orQP+R4RHC0uEEX9sYlH/UEkqA=="></div>    <input type="hidden" name="repository_id" value="7667591">
    <input type="hidden" name="thread_id" value="44679748">
    <input type="hidden" name="thread_class" value="Issue">
    <input type="hidden" name="id" value="mute">

    <button class="minibutton" type="submit" data-disable-with="">
      <span class="octicon octicon-mute"></span>
      Unsubscribe
    </button>
</form>
  <p class="reason">You're receiving notifications because you were assigned.</p>
</div>

  </div>

<div id="partial-users-participants" class="discussion-sidebar-item js-socket-channel js-updatable-content" data-channel="agnwinds/python:issue:44679748" data-url="/agnwinds/python/issues/118/show_partial?partial=participants">
  <div class="participation">

    <h3 class="discussion-sidebar-heading">
      2 participants
    </h3>
    <div class="participation-avatars">
        <a class="participant-avatar tooltipped tooltipped-s" aria-label="jhmatthews" href="https://github.com/jhmatthews"><img alt="James Matthews" class="avatar" data-user="3007249" height="20" src="./dvds_issue_files/3007249" width="20"></a>
        <a class="participant-avatar tooltipped tooltipped-s" aria-label="kslong" href="https://github.com/kslong"><img alt="kslong" class="avatar" data-user="2530901" height="20" src="./dvds_issue_files/2530901" width="20"></a>
    </div>
  </div>
</div>



  <div class="discussion-sidebar-item lock-toggle">
    <a href="https://github.com/agnwinds/python/issues/118#lock-confirmation" rel="facebox" class="lock-toggle-link">
        <span class="octicon octicon-lock"></span>
      Lock issue
    </a>

    <div id="lock-confirmation" style="display:none">
      <h2 class="facebox-header">Lock conversation on this issue</h2>

      <p>Locking the conversation means:</p>

      <ul>
          <li>Other users <strong>can't add new comments</strong> to this issue.</li>
            <li>
              You and other collaborators
              <a href="https://help.github.com/articles/what-are-the-different-access-permissions">with access</a>
              to this repository <strong>can still leave comments</strong> that others can see.
            </li>
      </ul>

      <p>You can always unlock this issue again in the future.</p>

      <div class="facebox-footer">
        <a href="https://github.com/agnwinds/python/issues/118/lock" class="button danger button-block" data-method="put">Lock this issue</a>
      </div>
    </div>
  </div>


      </div>

      <div class="discussion-timeline js-quote-selection-container">

        <div class="js-discussion js-socket-channel" data-channel="agnwinds/python:marked-as-read:44679748">
          

  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issue-44679748" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="1950d50b16bbdcdf7b6b602529745174">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issue-44679748" class="timestamp">
      <time datetime="2014-10-02T12:14:53Z" is="relative-time" title="Oct 2, 2014, 8:14 AM EDT">on Oct 2</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>This is, I believe, a separate issue to the lack of doppler shift described in <a href="https://github.com/agnwinds/python/issues/117" class="issue-link" title="live_or_die doesn&#39;t agree with extract for spherical and supernova models">#117</a> so I am creating a new issue. That issue should be consulted for history of the problems.</p>

<p>Running a spherical mode in spherical coordinates (~/Dropbox/Python/sphere_out_issue117/ contains the required files) produces line profiles which change as a function of viewing angle in both extract and live or die mode. The following figure demonstrates this:</p>

<p><a href="./dvds_issue_files/5c104122-4a2d-11e4-8c4d-15f72445a460.png" target="_blank"><img src="./dvds_issue_files/5c104122-4a2d-11e4-8c4d-15f72445a460.png" alt="spec_sphere_out_100" style="max-width:100%;"></a></p>

<p>In cylindrical coordinates this dependence goes away for an identical model, and the line profile always looks like the middle panel. </p>

<p>I've also checked that this occurs for both 30 and 100 grid cells, so it doesn't appear to be a special gridding artefact.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="./dvds_issue_files/dvds_issue.html" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="V+FbsQByEbvWswoPNrOVKnQjSabUSaetikOlGE8wrRkO1PalhDeEOJOgCRfN4VoFhlFEJbyhHpLc97QY9cFwTA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issue-44679748-body" name="issue[body]" tabindex="1">This is, I believe, a separate issue to the lack of doppler shift described in #117 so I am creating a new issue. That issue should be consulted for history of the problems.

Running a spherical mode in spherical coordinates (~/Dropbox/Python/sphere_out_issue117/ contains the required files) produces line profiles which change as a function of viewing angle in both extract and live or die mode. The following figure demonstrates this:

![spec_sphere_out_100](https://cloud.githubusercontent.com/assets/3007249/4490553/5c104122-4a2d-11e4-8c4d-15f72445a460.png)

In cylindrical coordinates this dependence goes away for an identical model, and the line profile always looks like the middle panel. 

I've also checked that this occurs for both 30 and 100 grid cells, so it doesn't appear to be a special gridding artefact.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  


      


<div class="discussion-item discussion-item-labeled">
  <div class="discussion-item-header" id="event-173212176">

    <span class="octicon octicon-tag discussion-item-icon"></span>
    <img alt="James Matthews" class="avatar" data-user="3007249" height="16" src="./dvds_issue_files/3007249(2)" width="16">
    <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    added the <span class="label-color" style="background-color: #207de5;"><a href="https://github.com/agnwinds/python/labels/bug" style="color: #fff">bug</a></span> label <a href="https://github.com/agnwinds/python/issues/118#event-173212176" class="timestamp"><time class="timestamp" datetime="2014-10-02T12:14:53Z" is="relative-time" title="Oct 2, 2014, 8:14 AM EDT">on Oct 2</time></a>
  </div>
</div>





      


<div class="discussion-item discussion-item-assigned">
  <div class="discussion-item-header" id="event-173212177">

    <span class="octicon octicon-person discussion-item-icon"></span>
    <img alt="James Matthews" class="avatar" data-user="3007249" height="16" src="./dvds_issue_files/3007249(2)" width="16">
    <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    self-assigned this   <a href="https://github.com/agnwinds/python/issues/118#event-173212177" class="timestamp"><time class="timestamp" datetime="2014-10-02T12:14:53Z" is="relative-time" title="Oct 2, 2014, 8:14 AM EDT">on Oct 2</time></a>
  </div>
</div>





      


<div class="discussion-item discussion-item-milestoned">
  <div class="discussion-item-header" id="event-173212178">

    <span class="octicon octicon-milestone discussion-item-icon"></span>
    <img alt="James Matthews" class="avatar" data-user="3007249" height="16" src="./dvds_issue_files/3007249(2)" width="16">
    <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    added this to the <a href="https://github.com/agnwinds/python/milestones/Public%20Release" class="discussion-item-entity">Public Release</a> milestone <a href="https://github.com/agnwinds/python/issues/118#event-173212178" class="timestamp"><time class="timestamp" datetime="2014-10-02T12:14:53Z" is="relative-time" title="Oct 2, 2014, 8:14 AM EDT">on Oct 2</time></a>
  </div>
</div>





      


<div class="discussion-item discussion-item-labeled">
  <div class="discussion-item-header" id="event-173733388">

    <span class="octicon octicon-tag discussion-item-icon"></span>
    <img alt="James Matthews" class="avatar" data-user="3007249" height="16" src="./dvds_issue_files/3007249(2)" width="16">
    <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    added the <span class="label-color" style="background-color: #fbca04;"><a href="https://github.com/agnwinds/python/labels/medium" style="color: #332900">medium</a></span> label <a href="https://github.com/agnwinds/python/issues/118#event-173733388" class="timestamp"><time class="timestamp" datetime="2014-10-03T10:24:55Z" is="relative-time" title="Oct 3, 2014, 6:24 AM EDT">on Oct 3</time></a>
  </div>
</div>



  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-58947992" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="6c3d69c98e0b6ee059590d876c906ec2">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/58947992" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-58947992" class="timestamp">
      <time datetime="2014-10-13T20:13:31Z" is="relative-time" title="Oct 13, 2014, 4:13 PM EDT">on Oct 13</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>I am fairly sure thatt he root cause of this problem is that velocities in xyz coordinates are not being calculated correctly for a spherical wind, as photons pass through it.  The lines in vwind_xyz that convert the velocity vector contained in w to the local velocity are almost certainly wrong in the spherical case.  Among other problems, the code seems to imply that the velocity could never be directed inward.</p>

<p>Note that this is consistent with the fact that neither spherical polar nor cylindrical coordinates exhibit a problem.</p>

<p>Note that in spherical_make_grid, the coordinates of the cells are set up in the x,z plane at 45 degrees.  This may account for in part why things work there as well.  (The rationale for using 45 degrees was that this was most likely to be contained in a biconical wind, but that may have been a silly choice nonetheless. </p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/58947992" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="VSCvPHwEfSLajJfsv+DrxMG9IrBThK0dqozuX9YnkaFMExNwFUl47WvdrYjFplSWt9AWKLL+G2GLbaMR2fQ9nQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-58947992-body" name="issue_comment[body]" tabindex="1">I am fairly sure thatt he root cause of this problem is that velocities in xyz coordinates are not being calculated correctly for a spherical wind, as photons pass through it.  The lines in vwind_xyz that convert the velocity vector contained in w to the local velocity are almost certainly wrong in the spherical case.  Among other problems, the code seems to imply that the velocity could never be directed inward.

Note that this is consistent with the fact that neither spherical polar nor cylindrical coordinates exhibit a problem.

Note that in spherical_make_grid, the coordinates of the cells are set up in the x,z plane at 45 degrees.  This may account for in part why things work there as well.  (The rationale for using 45 degrees was that this was most likely to be contained in a biconical wind, but that may have been a silly choice nonetheless. </textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  


      


<div class="discussion-item discussion-item-labeled">
  <div class="discussion-item-header" id="event-177876014">

    <span class="octicon octicon-tag discussion-item-icon"></span>
    <img alt="kslong" class="avatar" data-user="2530901" height="16" src="./dvds_issue_files/2530901(2)" width="16">
    <a href="https://github.com/kslong" class="author">kslong</a>
    added the <span class="label-color" style="background-color: #eb6420;"><a href="https://github.com/agnwinds/python/labels/high" style="color: #fff">high</a></span> label <a href="https://github.com/agnwinds/python/issues/118#event-177876014" class="timestamp"><time class="timestamp" datetime="2014-10-13T20:53:39Z" is="relative-time" title="Oct 13, 2014, 4:53 PM EDT">on Oct 13</time></a>
  </div>
</div>



  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-58953225" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="b519d383211afeecc07c5c5308641fa4">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/58953225" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-58953225" class="timestamp">
      <time datetime="2014-10-13T20:53:48Z" is="relative-time" title="Oct 13, 2014, 4:53 PM EDT">on Oct 13</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>There are several things I do not understand about the vwind_xyz routine.  It also looks as if in cylindrical coordinates that the v velocity is not reversed if the coordinate position is below the disk plane.  </p>

<p>Note that there are some general routines in vector.c that are intended to project from one frame to another.  These seem to be mainly used by py_wind however.  It's not clear they are the generalized routines we want.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/58953225" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="J340VhbI+EIjx7/yRY4gz1D+33gGs1BEEg/PEKqxq5XVJostnsl/Uo+fFt9d8Udq0tZwb0N9KTJdB1P3Mn979A=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-58953225-body" name="issue_comment[body]" tabindex="1">There are several things I do not understand about the vwind_xyz routine.  It also looks as if in cylindrical coordinates that the v velocity is not reversed if the coordinate position is below the disk plane.  

Note that there are some general routines in vector.c that are intended to project from one frame to another.  These seem to be mainly used by py_wind however.  It's not clear they are the generalized routines we want.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  


      


<div class="discussion-item discussion-item-unlabeled">
  <div class="discussion-item-header" id="event-177876459">

    <span class="octicon octicon-tag discussion-item-icon"></span>
    <img alt="kslong" class="avatar" data-user="2530901" height="16" src="./dvds_issue_files/2530901(2)" width="16">
    <a href="https://github.com/kslong" class="author">kslong</a>
    removed the <span class="label-color" style="background-color: #fbca04;"><a href="https://github.com/agnwinds/python/labels/medium" style="color: #332900">medium</a></span> label <a href="https://github.com/agnwinds/python/issues/118#event-177876459" class="timestamp"><time class="timestamp" datetime="2014-10-13T20:54:39Z" is="relative-time" title="Oct 13, 2014, 4:54 PM EDT">on Oct 13</time></a>
  </div>
</div>



      


<div class="discussion-item discussion-item-labeled">
  <div class="discussion-item-header" id="event-177876498">

    <span class="octicon octicon-tag discussion-item-icon"></span>
    <img alt="kslong" class="avatar" data-user="2530901" height="16" src="./dvds_issue_files/2530901(2)" width="16">
    <a href="https://github.com/kslong" class="author">kslong</a>
      added <span class="label-color" style="background-color: #009800;"><a href="https://github.com/agnwinds/python/labels/low" style="color: #fff">low</a></span> and removed <span class="label-color" style="background-color: #009800;"><a href="https://github.com/agnwinds/python/labels/low" style="color: #fff">low</a></span> labels <a href="https://github.com/agnwinds/python/issues/118#event-177876498" class="timestamp"><time class="timestamp" datetime="2014-10-13T20:54:45Z" is="relative-time" title="Oct 13, 2014, 4:54 PM EDT">on Oct 13</time></a>
  </div>
</div>



  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-59008682" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="6f739d9d6b63315c942bfc79e65e2dbd">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/59008682" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-59008682" class="timestamp">
      <time datetime="2014-10-14T08:46:20Z" is="relative-time" title="Oct 14, 2014, 4:46 AM EDT">on Oct 14</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Knox, there's a line in all coordinate systems except spherical which does this</p>

<div class="highlight highlight-C"><pre><span class="pl-k">else</span> <span class="pl-k">if</span> (p-&gt;x[<span class="pl-cn">2</span>] &lt; <span class="pl-cn">0</span>)       <span class="pl-c"><span class="pl-pdc">//</span> For 2d coord systems, velocity is reversed if the photon is in the lower hemisphere.</span>
    vv[<span class="pl-cn">2</span>] *= -<span class="pl-cn">1</span>;</pre></div>

<p>so I that should take care of velocities in the lower hemisphere. </p>

<p>What the wind_xyz routine is doing in spherical coodinates is not entirely clear to me yet, but I'm looking into it.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/59008682" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="kc9qq7QFTTzbrEuPU8jpQuBI3WWvB3UgI81bUWRBqeBTR5bvTjDlGlCSyiUDc77V4fNwbHOsOr/Dtc7CeUucFA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-59008682-body" name="issue_comment[body]" tabindex="1">Knox, there's a line in all coordinate systems except spherical which does this

```C
else if (p-&gt;x[2] &lt; 0)		// For 2d coord systems, velocity is reversed if the photon is in the lower hemisphere.
    vv[2] *= -1;
```

so I that should take care of velocities in the lower hemisphere. 

What the wind_xyz routine is doing in spherical coodinates is not entirely clear to me yet, but I'm looking into it.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61143516" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="e2bb733f1322e2e61ea6be4d92a223a4">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61143516" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61143516" class="timestamp">
      <time datetime="2014-10-30T18:21:18Z" is="relative-time" title="Oct 30, 2014, 2:21 PM EDT">13 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>James will check that changing the angle at which the velocities etc are calculated from 45 degrees to something else does or does not move the angle at which the spectra are correct.  If that is not the case, then it is fairly unclear what the problem is specifically.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61143516" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="b5BlG6u+v+afGKaVKHqoLbpNIlClhI/3G0ORWmnfjowWQVD9pyXM34JD4cJt9a80rshJUiEBOjNG/7VWD3rLXw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61143516-body" name="issue_comment[body]" tabindex="1">James will check that changing the angle at which the velocities etc are calculated from 45 degrees to something else does or does not move the angle at which the spectra are correct.  If that is not the case, then it is fairly unclear what the problem is specifically.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61279264" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="9e8878026f8b272f71e849dd983d26ab">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61279264" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61279264" class="timestamp">
      <time datetime="2014-10-31T15:39:54Z" is="relative-time" title="Oct 31, 2014, 11:39 AM EDT">12 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Increasing the number of cells a spherical model using spherical coordinates does not change the the spectrum that is produced.  The figure below shows the model we have been testing but with 500 cells in the radial grid.  </p>

<p><a href="./dvds_issue_files/27cfa83c-6114-11e4-9741-ce150b2df90e.png" target="_blank"><img src="./dvds_issue_files/27cfa83c-6114-11e4-9741-ce150b2df90e.png" alt="test" style="max-width:100%;"></a></p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61279264" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="o+9ForPNcuQr4FYgo/mG1FV3fZ5XZaXd61DCYSVKddkWhG2WkQJ3tDweuhdwU+6+aiVDnQk6dFFoE55ib7MQuw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61279264-body" name="issue_comment[body]" tabindex="1">Increasing the number of cells a spherical model using spherical coordinates does not change the the spectrum that is produced.  The figure below shows the model we have been testing but with 500 cells in the radial grid.  

![test](https://cloud.githubusercontent.com/assets/2530901/4863368/27cfa83c-6114-11e4-9741-ce150b2df90e.png)


</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  


      


<div class="discussion-item discussion-item-closed">
  <div class="discussion-item-header" id="event-186628665">

    <span class="octicon octicon-circle-slash discussion-item-icon"></span>
    <img alt="kslong" class="avatar" data-user="2530901" height="16" src="./dvds_issue_files/2530901(2)" width="16">
    <a href="https://github.com/kslong" class="author">kslong</a>
    closed this   <a href="https://github.com/agnwinds/python/issues/118#event-186628665" class="timestamp"><time class="timestamp" datetime="2014-10-31T15:39:54Z" is="relative-time" title="Oct 31, 2014, 11:39 AM EDT">12 days ago</time></a>
  </div>
</div>

  <div class="closed-banner"></div>




      


<div class="discussion-item discussion-item-reopened">
  <div class="discussion-item-header" id="event-186630171">

    <span class="octicon octicon-primitive-dot discussion-item-icon"></span>
    <img alt="kslong" class="avatar" data-user="2530901" height="16" src="./dvds_issue_files/2530901(2)" width="16">
    <a href="https://github.com/kslong" class="author">kslong</a>
    reopened this   <a href="https://github.com/agnwinds/python/issues/118#event-186630171" class="timestamp"><time class="timestamp" datetime="2014-10-31T15:42:17Z" is="relative-time" title="Oct 31, 2014, 11:42 AM EDT">12 days ago</time></a>
  </div>
</div>



  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61290480" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="3ebbda2920fb6db1b4c60af76d34042d">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61290480" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61290480" class="timestamp">
      <time datetime="2014-10-31T16:46:34Z" is="relative-time" title="Oct 31, 2014, 12:46 PM EDT">12 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>The main problem is mostly associated with the blue wing, which looks like a pure absorption effect.  This seems confirmed by this test, where I show spectra calculated for 0 and 1 scatters specifically.  This really does argue that somehow we are calculating the line absorption incorrectly.  It is also interesting that everything seems symmetric about 45 degrees.</p>

<p><a href="./dvds_issue_files/740a7430-611d-11e4-863f-a3359f0e9a15.png" target="_blank"><img src="./dvds_issue_files/740a7430-611d-11e4-863f-a3359f0e9a15.png" alt="scatters" style="max-width:100%;"></a></p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61290480" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="zZ9ZrqVwxGzBZA8EcF6D1rkNt9A7c6pt24YnLDsyCkR+hZltEqZFwp794w6qqgoMP5Ci7kipO/40trUxuJ4kbw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61290480-body" name="issue_comment[body]" tabindex="1">The main problem is mostly associated with the blue wing, which looks like a pure absorption effect.  This seems confirmed by this test, where I show spectra calculated for 0 and 1 scatters specifically.  This really does argue that somehow we are calculating the line absorption incorrectly.  It is also interesting that everything seems symmetric about 45 degrees.

![scatters](https://cloud.githubusercontent.com/assets/2530901/4864582/740a7430-611d-11e4-863f-a3359f0e9a15.png)
</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-61583262" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="fd324f81ff2f7f86a8d04323b97623cf">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61583262" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61583262" class="timestamp">
      <time datetime="2014-11-04T02:10:35Z" is="relative-time" title="Nov 3, 2014, 9:10 PM EST">9 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>I've been trying to figure this out today and have made some progress. I'd already checked that the optical depths photons experience in different directions appear to be wrong. I then tried checking the velocities along each line of sight- these appear to be correct. I did this by forcing photons to go along the viewing angles of the spectra.</p>

<p>I then tried editing the code in dvwind_ds. Currently the code seems to interpolate on a three-vector which stores dvds in each co-ordinate direction. </p>

<p>Modifying the dvwind_ds routine to the following code</p>

<div class="highlight highlight-C"><pre>  ds = <span class="pl-cn">1.0</span>;
  <span class="pl-enf">vwind_xyz</span>(&amp;pp, v1);

  <span class="pl-enf">stuff_phot</span>(&amp;pp, &amp;pnew);
  <span class="pl-enf">move_phot</span>(&amp;pnew, ds);

  <span class="pl-enf">vwind_xyz</span>(&amp;pnew, v2);

  <span class="pl-enf">vsub</span> (v2, v1, diff);
  dvds = length (diff);

  <span class="pl-k">return</span> dvds;</pre></div>

<p>i.e. simply calculating the velocity at ds=1.0 along the direction of the photon produces what appear to be the correct results:</p>

<p><a href="./dvds_issue_files/5f10f85e-63c7-11e4-871f-7ab52ce80cf7.png" target="_blank"><img src="./dvds_issue_files/5f10f85e-63c7-11e4-871f-7ab52ce80cf7.png" alt="pcyg" style="max-width:100%;"></a></p>

<p>So something is going wrong in the dvds routine. This could either be in the original calculation of the v_grad stored in the wind pointer, the interpolation, or perhaps in the projection into different coordinates. There's definitely a question about whether the routine works in other cooadrdinates other than cylindrical.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61583262" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="xGHR1t1hwM77PDUG3Wwmn0QaJ1hwkh6Bsh5DlP714IFfaTON42cqnLTrpszEbRak4nsBTxtxUdOJa6I99jbhRQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61583262-body" name="issue_comment[body]" tabindex="1">I've been trying to figure this out today and have made some progress. I'd already checked that the optical depths photons experience in different directions appear to be wrong. I then tried checking the velocities along each line of sight- these appear to be correct. I did this by forcing photons to go along the viewing angles of the spectra.

I then tried editing the code in dvwind_ds. Currently the code seems to interpolate on a three-vector which stores dvds in each co-ordinate direction. 

Modifying the dvwind_ds routine to the following code

```C
  ds = 1.0;
  vwind_xyz(&amp;pp, v1);

  stuff_phot(&amp;pp, &amp;pnew);
  move_phot(&amp;pnew, ds);

  vwind_xyz(&amp;pnew, v2);

  vsub (v2, v1, diff);
  dvds = length (diff);

  return dvds;
```

i.e. simply calculating the velocity at ds=1.0 along the direction of the photon produces what appear to be the correct results:

![pcyg](https://cloud.githubusercontent.com/assets/3007249/4893797/5f10f85e-63c7-11e4-871f-7ab52ce80cf7.png)

So something is going wrong in the dvds routine. This could either be in the original calculation of the v_grad stored in the wind pointer, the interpolation, or perhaps in the projection into different coordinates. There's definitely a question about whether the routine works in other cooadrdinates other than cylindrical.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61639642" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="2fe11e891d7b4edad072bdd75c9118d0">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61639642" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61639642" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61639642" class="timestamp">
      <time datetime="2014-11-04T13:35:14Z" is="relative-time" title="Nov 4, 2014, 8:35 AM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">Interesting.  What was it doing differently before, and is this likely to be a lot more inefficient than what we had

Note, although you should recheck this, I believe we do not have a problem with spherical polar coordinates either.  If correct, this suggests our problem is isolated to 1-d coordinates, as opposed to being something else.  That kind of makes sense.

 Note, you have gotten me worried about the the tensor bits which are used for scattering, even though that does not seem to be the source of our problem here.  It seems as if all of the tensors should be multiplied by something to preserve the correct orientation in various coordinate systems.

P. S.  I did also confirm that velocities were not the problem, but had not gotten further on this.</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61639642" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="ChjbrdJ7UxYfBhkX3aXpXwuGuC96q/vY/sGqetNoBIJE23DfGVRgRza+2rtoskoJeHLOuAHzyaD1TSkN99MOLw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61639642-body" name="issue_comment[body]" tabindex="1">Interesting.  What was it doing differently before, and is this likely to be a lot more inefficient than what we had

Note, although you should recheck this, I believe we do not have a problem with spherical polar coordinates either.  If correct, this suggests our problem is isolated to 1-d coordinates, as opposed to being something else.  That kind of makes sense.

 Note, you have gotten me worried about the the tensor bits which are used for scattering, even though that does not seem to be the source of our problem here.  It seems as if all of the tensors should be multiplied by something to preserve the correct orientation in various coordinate systems.

P. S.  I did also confirm that velocities were not the problem, but had not gotten further on this.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-61664792" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="c99ea8e609bfcae53eaaecdc261de691">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61664792" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61664792" class="timestamp">
      <time datetime="2014-11-04T16:14:32Z" is="relative-time" title="Nov 4, 2014, 11:14 AM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>What it was doing before:</p>

<ul class="task-list">
<li>v_grad was calculated upon setting up the wind in each cell. v_grad here is the velocity gradient tensor at the inner vertex of the cell, and is a 3x3 matrix with the components being (I think)</li>
</ul>

<p>dv_x/dx  dv_x/dy  dv_x/dz <br>
dv_y/dx  dv_y/dy  dv_y/dz <br>
dv_z/dx  dv_z/dy  dv_z/dz </p>

<p>This is done by the routine model_vgrad(), which does much the same as my little piece of code above.</p>

<ul class="task-list">
<li>In dvwind_ds, we then use our normal interpolation procedures for calculating the velocity gradient tensor, using coord_fraction to weights by which we calculate </li>
</ul>

<div class="highlight highlight-C"><pre>  n = coord_fraction (<span class="pl-cn">0</span>, pp.x, nnn, frac, &amp;nelem);

  <span class="pl-k">for</span> (j = <span class="pl-cn">0</span>; j &lt; <span class="pl-cn">3</span>; j++)
    {
      <span class="pl-k">for</span> (k = <span class="pl-cn">0</span>; k &lt; <span class="pl-cn">3</span>; k++)
    {
      x = <span class="pl-cn">0</span>;
      <span class="pl-k">for</span> (nn = <span class="pl-cn">0</span>; nn &lt; nelem; nn++)
        x += wmain[nnn[nn]].<span class="pl-v">v_grad</span>[j][k] * frac[nn];

      v_grad[j][k] = x;
    }
    }</pre></div>

<ul class="task-list">
<li>there is then this section of code:</li>
</ul>

<div class="highlight highlight-C"><pre>  <span class="pl-c"><span class="pl-pdc">//</span> ??? Not clear this is coorrect !!!  for multiple coordinate systems </span>
<span class="pl-c"><span class="pl-pdc">/*</span> v_grad is in cylindrical cordinates, or more precisely intended</span>
<span class="pl-c">to be azimuthally symmetric.  One could either </span>
<span class="pl-c">(a) convert v_grad to cartesian coordinates at the position of the</span>
<span class="pl-c">photon or (b) </span>
<span class="pl-c">convert the photon direction to cylindrical coordinates </span>
<span class="pl-c">at the position of the photon. Possibility b is more straightforward</span>
<span class="pl-c">given the existing code <span class="pl-pdc">*/</span></span>

  <span class="pl-enf">project_from_xyz_cyl</span> (pp.x, pp.lmn, lmn);
  dvds = dot_tensor_vec (v_grad, lmn, dvel_ds);</pre></div>

<p>I'm a little confused because the comments in model_vgrad() tend to imply it's calculated in cartesian coordinates- so the thing I'm trying to get to the bottom of now is what coordinate systems the routines expect and whether this is done correctly. </p>

<p>Re Spherical polar- yes, I checked this, and the results are fine in spherical polar coordinates.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61664792" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="2nhYGosekyxByCchHZ0L2jNubiNLHftKZT4kqu4Fm/rJ61UIsBPZSvZiUxQSCifdefUNigVJoyoFM6QEsUhd3Q=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61664792-body" name="issue_comment[body]" tabindex="1">What it was doing before:

* v_grad was calculated upon setting up the wind in each cell. v_grad here is the velocity gradient tensor at the inner vertex of the cell, and is a 3x3 matrix with the components being (I think)

dv_x/dx  dv_x/dy  dv_x/dz 
dv_y/dx  dv_y/dy  dv_y/dz 
dv_z/dx  dv_z/dy  dv_z/dz 

This is done by the routine model_vgrad(), which does much the same as my little piece of code above.

* In dvwind_ds, we then use our normal interpolation procedures for calculating the velocity gradient tensor, using coord_fraction to weights by which we calculate 

```C
  n = coord_fraction (0, pp.x, nnn, frac, &amp;nelem);

  for (j = 0; j &lt; 3; j++)
    {
      for (k = 0; k &lt; 3; k++)
	{
	  x = 0;
	  for (nn = 0; nn &lt; nelem; nn++)
	    x += wmain[nnn[nn]].v_grad[j][k] * frac[nn];

	  v_grad[j][k] = x;
	}
    }
```

* there is then this section of code:

```C
  // ??? Not clear this is coorrect !!!  for multiple coordinate systems 
/* v_grad is in cylindrical cordinates, or more precisely intended
to be azimuthally symmetric.  One could either 
(a) convert v_grad to cartesian coordinates at the position of the
photon or (b) 
convert the photon direction to cylindrical coordinates 
at the position of the photon. Possibility b is more straightforward
given the existing code */

  project_from_xyz_cyl (pp.x, pp.lmn, lmn);
  dvds = dot_tensor_vec (v_grad, lmn, dvel_ds);
```

I'm a little confused because the comments in model_vgrad() tend to imply it's calculated in cartesian coordinates- so the thing I'm trying to get to the bottom of now is what coordinate systems the routines expect and whether this is done correctly. 

Re Spherical polar- yes, I checked this, and the results are fine in spherical polar coordinates.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61670397" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="23af6ecdbad548cd37790771874bb541">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61670397" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61670397" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61670397" class="timestamp">
      <time datetime="2014-11-04T16:42:02Z" is="relative-time" title="Nov 4, 2014, 11:42 AM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">I suspect the cartesian coordinate comment refers to the fact that it is calculated in the xz plane, and this may be OK for any 2d azimuthal coordinate system, in this case the unit vectors for cartesian and cylindrical coordinates would be identical.   (The tensor would be the same everywhere in cylindrical coordinates for fixed rho and z).

Clearly, though if we calculate the tensor in what effectively is tensor coordinates we have to project the photon direction into cylindrical coordinates, before trying to calculate dvds.  We don’t care about anything but the magnitude so we don’t have to project back.

Now this also would probably explain why we are failing to get things right in spherical coordinates, and that is because the tensor is being calculated along one particular line in the xz plane, not everywhere, which is what we need.  We have lost the theta dependence that we need.    (The only thing that bothers me about this, is that changing the angle at which the spherical model was calculated had no effect and I would have expected it to.)

Looking at the lines of code you wrote, it seems likely that the change you suggested earlier will not be very expensive, maybe even faster than what we have, so maybe this is the best solution.  If we can afford it, this looks like the most robust, should we ever go to a non-azimuathally symmetric wind.

But we need to look at other  places where the tensor is used, and check that we don’t have something going on there as well.</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61670397" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="wV6rcV4VonTA2KAjp53vMton+fd2L7iIMhOvsmj/eGZouo3+YHX/IskQlZrvhkCeDfcFDbVD246GpbnXlcCoHQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61670397-body" name="issue_comment[body]" tabindex="1">I suspect the cartesian coordinate comment refers to the fact that it is calculated in the xz plane, and this may be OK for any 2d azimuthal coordinate system, in this case the unit vectors for cartesian and cylindrical coordinates would be identical.   (The tensor would be the same everywhere in cylindrical coordinates for fixed rho and z).

Clearly, though if we calculate the tensor in what effectively is tensor coordinates we have to project the photon direction into cylindrical coordinates, before trying to calculate dvds.  We don’t care about anything but the magnitude so we don’t have to project back.

Now this also would probably explain why we are failing to get things right in spherical coordinates, and that is because the tensor is being calculated along one particular line in the xz plane, not everywhere, which is what we need.  We have lost the theta dependence that we need.    (The only thing that bothers me about this, is that changing the angle at which the spherical model was calculated had no effect and I would have expected it to.)

Looking at the lines of code you wrote, it seems likely that the change you suggested earlier will not be very expensive, maybe even faster than what we have, so maybe this is the best solution.  If we can afford it, this looks like the most robust, should we ever go to a non-azimuathally symmetric wind.

But we need to look at other  places where the tensor is used, and check that we don’t have something going on there as well.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-61688694" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="eb4522b890f9f6f22c0dd7437da9ea6d">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61688694" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61688694" class="timestamp">
      <time datetime="2014-11-04T18:24:14Z" is="relative-time" title="Nov 4, 2014, 1:24 PM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>hmm, OK. I'm not sure I completely understand, but perhaps we can discuss next time we have a telecon.</p>

<p>I've profiled the proposed change. There is a slight increase in the time spent in the routine but the overall time spent in dvwind_ds is on the order of 0.1 second over a spectral cycle and is a fraction of the calculate_ds routine, so it doesn't matter. </p>

<p>I can therefore implement this- the only thing to be slightly careful of is how to set ds so as to avoid numerical problems but provide the right accuracy. It appears 1e7 was set as the minimum in the calculation of v_grad. I'll try and do some relevant tests and put in error conditions and sanity checks.</p>

<p>I presume we want this method to be used in all coordinate systems? In which case we could probably remove v_grad from the wind structure.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61688694" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="sBnDwzwWm3AB6fuHdaIfjtX2RGPdU45GNtsL9fqVVSVnVSfdidhYh8Z+vzAcUvGbCR6ZOanBWsQDV2dcyD/WFw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61688694-body" name="issue_comment[body]" tabindex="1">hmm, OK. I'm not sure I completely understand, but perhaps we can discuss next time we have a telecon.

I've profiled the proposed change. There is a slight increase in the time spent in the routine but the overall time spent in dvwind_ds is on the order of 0.1 second over a spectral cycle and is a fraction of the calculate_ds routine, so it doesn't matter. 

I can therefore implement this- the only thing to be slightly careful of is how to set ds so as to avoid numerical problems but provide the right accuracy. It appears 1e7 was set as the minimum in the calculation of v_grad. I'll try and do some relevant tests and put in error conditions and sanity checks.

I presume we want this method to be used in all coordinate systems? In which case we could probably remove v_grad from the wind structure.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61690002" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="cf2ded42093f7f410963e2bd62133943">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61690002" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61690002" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61690002" class="timestamp">
      <time datetime="2014-11-04T18:32:12Z" is="relative-time" title="Nov 4, 2014, 1:32 PM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">Yes, I think we would want to switch to this for everything, assuming the cost is as small as you estimate.

So, is this the only place we use the gradients?  When I did a grep it looked like it, though the gradients are set up in several other routines.  Knox</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61690002" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="fKzJeE5Zdg4hHnCXuksrNYFeWSDXeCJ3IFkzGKC5N8r1+5k/RavT1713vvxggc2/yCTNXdDLsVSW0pNNUZbZGw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61690002-body" name="issue_comment[body]" tabindex="1">Yes, I think we would want to switch to this for everything, assuming the cost is as small as you estimate.

So, is this the only place we use the gradients?  When I did a grep it looked like it, though the gradients are set up in several other routines.  Knox</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-61693202" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="a9af1c9ec1204454d95b15db17b6b737">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61693202" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61693202" class="timestamp">
      <time datetime="2014-11-04T18:52:48Z" is="relative-time" title="Nov 4, 2014, 1:52 PM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Yes sorry, I forgot to mention that. This particular tensor (i.e. v_grad) only appears to be actually used in this function, and it is just set up by some other routines. </p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61693202" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="1+PgRz7qzPjz/apFZeQr2mOb2iBLTXj0wKenkuZUytyOVKjAR/wwReg3I6Z2a/XRROmj2tnSESSyNlZ7kAgwAQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61693202-body" name="issue_comment[body]" tabindex="1">Yes sorry, I forgot to mention that. This particular tensor (i.e. v_grad) only appears to be actually used in this function, and it is just set up by some other routines. </textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-61701645" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="0830960bd2e46e7cd25c0fbd5f6a070b">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61701645" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61701645" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61701645" class="timestamp">
      <time datetime="2014-11-04T19:44:36Z" is="relative-time" title="Nov 4, 2014, 2:44 PM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">So, why don’t you go ahead with this way of handling things, and then we should test it well, and move on to the next big thing.</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61701645" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="hR1l+VHAtuOsF2uOAoy+z+T87PYIqG7IBdxMVA9M8lXbuWwBq5RlR2dlo/Y2kTc3HrcSYy0DykZ5DEYqNQOrLg=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61701645-body" name="issue_comment[body]" tabindex="1">So, why don’t you go ahead with this way of handling things, and then we should test it well, and move on to the next big thing.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-61709718" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="37b5ee2e9c275522edf27fd0b565afe2">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/61709718" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-61709718" class="timestamp">
      <time datetime="2014-11-04T20:35:13Z" is="relative-time" title="Nov 4, 2014, 3:35 PM EST">8 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>I will do- however, I've realised that my proposed solution above is, in general, incorrect. The reason being that what I should be doing is evaluating the differential along the LoS of the photon (unit vector n) of the velocity projected along the same vector, i.e. dv_n/dn </p>

<p>This is not what I did above- I instead had calculated just dv/dn. The answer was the same because we are talking about absorption in a spherically symmetric wind and thus in this case the unit vectors were always radial and the velocity field is also radial.</p>

<p>The solution is then something like:</p>

<div class="highlight highlight-C"><pre>  ds = <span class="pl-cn">1.0</span>;
  <span class="pl-enf">vwind_xyz</span>(&amp;pp, v1);

  <span class="pl-enf">stuff_phot</span>(&amp;pp, &amp;pnew);
  <span class="pl-enf">move_phot</span>(&amp;pnew, ds);

  <span class="pl-enf">vwind_xyz</span>(&amp;pnew, v2);

  dvds = fabs(dot(v1, pp.lmn) - dot(v2, pp.lmn));

  <span class="pl-k">return</span> dvds;</pre></div>

<p>This is about the same timewise and produces the correct answer for this model. I will check explicitly that the models all look correct as with the old method for non spherical coordinate systems before implementing this change.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/61709718" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="VnTXSe68zW2/nyYOU+HZVhh+SpPZGZYqy15h0BdHLvESuwP9LQKFn8O2lI+jNJeyqaQgVf/2SsVIfjdt8i4s1g=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-61709718-body" name="issue_comment[body]" tabindex="1">I will do- however, I've realised that my proposed solution above is, in general, incorrect. The reason being that what I should be doing is evaluating the differential along the LoS of the photon (unit vector n) of the velocity projected along the same vector, i.e. dv_n/dn 

This is not what I did above- I instead had calculated just dv/dn. The answer was the same because we are talking about absorption in a spherically symmetric wind and thus in this case the unit vectors were always radial and the velocity field is also radial.

The solution is then something like:

```C
  ds = 1.0;
  vwind_xyz(&amp;pp, v1);

  stuff_phot(&amp;pp, &amp;pnew);
  move_phot(&amp;pnew, ds);

  vwind_xyz(&amp;pnew, v2);

  dvds = fabs(dot(v1, pp.lmn) - dot(v2, pp.lmn));

  return dvds;
```

This is about the same timewise and produces the correct answer for this model. I will check explicitly that the models all look correct as with the old method for non spherical coordinate systems before implementing this change.
</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62325514" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="e28802da97cac57146df8b6a9b53fe8b">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62325514" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62325514" class="timestamp">
      <time datetime="2014-11-09T23:34:07Z" is="relative-time" title="Nov 9, 2014, 6:34 PM EST">3 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>I haven't merged this change yet as there are some small differences in the spectra before/after that I want to understand. It's something that could potentially affect all our models to some extent so we should be careful that it works as expected.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62325514" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="ZjDdYnn04mvJnx3WqAtEfFQjIGIxcGXIztAwvjdXwmydUJtxoxCQWdklU39eupUy06gbUJMgpyCH3IcZsTV0dw=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62325514-body" name="issue_comment[body]" tabindex="1">I haven't merged this change yet as there are some small differences in the spectra before/after that I want to understand. It's something that could potentially affect all our models to some extent so we should be careful that it works as expected.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62452695" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="62cbe2e77549b94b7c62645ef07c89f7">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62452695" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62452695" class="timestamp">
      <time datetime="2014-11-10T20:51:15Z" is="relative-time" title="Nov 10, 2014, 3:51 PM EST">2 days ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Changing this method has next to no effect on the CV models, and simply fixes the spherical model to the correct behaviour.</p>

<p>In the AGN model, there are some changes along the absorption sightlines (here's the 75 and 80 deg sightline plotted with three methods- old, and new with two different values of ds)</p>

<p><a href="./dvds_issue_files/8114b988-691a-11e4-8f50-d6b98b9d0ac5.png" target="_blank"><img src="./dvds_issue_files/8114b988-691a-11e4-8f50-d6b98b9d0ac5.png" alt="compare_fiducial_agn" style="max-width:100%;"></a></p>

<p>In the old method, the velocity gradient tensor is calculated using a ds of 1e7cm, and interpolate on in the cycles. </p>

<p>In the new method, we calculate on the fly. While we are still sensitive to any non-linear behaviour of the velocity gradient along the sightline in question over the small distance ds, we are presumably doing better for directions which are well off an axis of the tensor, because you could have non-linear <em>direction</em> variations - meaning that a linear interpolation is not great. So, it's possible that this method is more accurate. </p>

<p>Any thoughts <a href="https://github.com/kslong" class="user-mention">@kslong</a> <a href="https://github.com/lazygun37" class="user-mention">@lazygun37</a> <a href="https://github.com/Higginbottom" class="user-mention">@Higginbottom</a> ? I can merge in, or I can try and do more digging by looking at the velocity field itself, say printing out dvds for each calculation and looking at the variation.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62452695" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="ol8cqAwKCU7RQTtbH+YOM6wnJm/TUUX6XFJ5lyc6zI0shYB7dfWIx5Sh+fYnGWaPKcDPVIhitBH8PFGRdzRTcA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62452695-body" name="issue_comment[body]" tabindex="1">Changing this method has next to no effect on the CV models, and simply fixes the spherical model to the correct behaviour.

In the AGN model, there are some changes along the absorption sightlines (here's the 75 and 80 deg sightline plotted with three methods- old, and new with two different values of ds)

![compare_fiducial_agn](https://cloud.githubusercontent.com/assets/3007249/4983392/8114b988-691a-11e4-8f50-d6b98b9d0ac5.png)

In the old method, the velocity gradient tensor is calculated using a ds of 1e7cm, and interpolate on in the cycles. 

In the new method, we calculate on the fly. While we are still sensitive to any non-linear behaviour of the velocity gradient along the sightline in question over the small distance ds, we are presumably doing better for directions which are well off an axis of the tensor, because you could have non-linear *direction* variations - meaning that a linear interpolation is not great. So, it's possible that this method is more accurate. 

Any thoughts @kslong @lazygun37 @Higginbottom ? I can merge in, or I can try and do more digging by looking at the velocity field itself, say printing out dvds for each calculation and looking at the variation.

</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-62569941" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="6e8df388ab5f900cbfb3d178f5902eb7">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62569941" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62569941" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62569941" class="timestamp">
      <time datetime="2014-11-11T16:10:35Z" is="relative-time" title="Nov 11, 2014, 11:10 AM EST">a day ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">Do these models have a disk in them?  I assume the answer is no.  If not, I guess we have a bit more work to do.

I think I would still recommend merging this back into dev however, as long as the changes do not affect the other coordinate systems.  We know the old approach was incorrect.

We should however put the .pf files that allow us to continue to study this on DropBox.

Knox</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62569941" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="+MdQi5dtI+2Tt+Is45PB65FTI+dAtf8LesZTMj0KrLdTqA5KfU4hjl/m5NpZfQDWVLLYfgaLgVCVNNahb+mdjA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62569941-body" name="issue_comment[body]" tabindex="1">Do these models have a disk in them?  I assume the answer is no.  If not, I guess we have a bit more work to do.

I think I would still recommend merging this back into dev however, as long as the changes do not affect the other coordinate systems.  We know the old approach was incorrect.

We should however put the .pf files that allow us to continue to study this on DropBox.

Knox</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62571899" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="7a21b120f11cf931509343f4de151942">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62571899" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62571899" class="timestamp">
      <time datetime="2014-11-11T16:22:07Z" is="relative-time" title="Nov 11, 2014, 11:22 AM EST">a day ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Sorry Knox should have been a little clearer there.</p>

<ul class="task-list">
<li>Changing the method of calculating dvds has no affect on a CV model in cylindrical coordinates (examples/cv_standard.pf)</li>
<li>It fixes a spherical wind model in spherical (1D) coords to the expected behaviour (see ~/Dropbox/Python/sphere_out_issue117/)</li>
<li>the effect on the fiducial AGN model in cylindrical coordinates is shown above (examples/fiducial_agn.pf)</li>
</ul>

<p>So yes, those two AGN spectra plotted above have a disk. The new method does have some effect on other coordinate systems at least in the AGN model, and it's not clear whether it's better or worse. These differences are fairly small but I don't fully understand them.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62571899" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="Y7CwxHyAlnYZDDElEhI/ydOQpSTSlMIciBW4mcNdr+2fkZEhAOzpyWkFx9X8h8Ar2oWk6UpbaS9+ITpmF8TdYA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62571899-body" name="issue_comment[body]" tabindex="1">Sorry Knox should have been a little clearer there.

* Changing the method of calculating dvds has no affect on a CV model in cylindrical coordinates (examples/cv_standard.pf)
* It fixes a spherical wind model in spherical (1D) coords to the expected behaviour (see ~/Dropbox/Python/sphere_out_issue117/)
* the effect on the fiducial AGN model in cylindrical coordinates is shown above (examples/fiducial_agn.pf)

So yes, those two AGN spectra plotted above have a disk. The new method does have some effect on other coordinate systems at least in the AGN model, and it's not clear whether it's better or worse. These differences are fairly small but I don't fully understand them.


</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-62574523" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="89796fa1ef8fa705b053141eedbf54b5">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62574523" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62574523" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62574523" class="timestamp">
      <time datetime="2014-11-11T16:37:02Z" is="relative-time" title="Nov 11, 2014, 11:37 AM EST">a day ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">OK, now I understand the concern.    It’s about real models of AGN at high inclination angles.  Unless anyone can come up with a reason why the old approach should be better, I think I am still in favor of merging.

 The only thing in the new models qualitatively was the appearance of new narrow lines at high inclination.  But There were some of these in the old method as well, so I’m not sure whether this is a real worry.

Cheers</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62574523" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="/Zan4SPE/ILkPv6wG3IWD6o7WLDcB7WlGmScrXagZMmBbuwOz8nZmlAWfH/irC+x2sNqZTI5KLHMPNL/Zg++CA=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62574523-body" name="issue_comment[body]" tabindex="1">OK, now I understand the concern.    It’s about real models of AGN at high inclination angles.  Unless anyone can come up with a reason why the old approach should be better, I think I am still in favor of merging.

 The only thing in the new models qualitatively was the appearance of new narrow lines at high inclination.  But There were some of these in the old method as well, so I’m not sure whether this is a real worry.

Cheers</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62613771" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="04fc706632f6f44b14cdb81ef2e37f3f">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62613771" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62613771" class="timestamp">
      <time datetime="2014-11-11T20:16:47Z" is="relative-time" title="Nov 11, 2014, 3:16 PM EST">a day ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Ok, so I wrote a little bit of code which evaluated the relevant velocity gradient at a load of points along the 75 degree sightline. I did this for the old method, and also for the new method with a load of different values for ds when evaluating dvds (see code above).</p>

<p>This is for the fiducial AGN model. I am not sure why the turnover at ~3e16 happens- where rotational gradients start being dominated by poloidal? The acceleration length here is 1e18cm.</p>

<p><a href="./dvds_issue_files/fd0be4fe-69b4-11e4-902f-4d5a315658f8.png" target="_blank"><img src="./dvds_issue_files/fd0be4fe-69b4-11e4-902f-4d5a315658f8.png" alt="dvds_variation" style="max-width:100%;"></a></p>

<p>The results are interesting. The old method does pretty badly near the base of the wind- presumably because the velocity field is fairly complex there and doing a linear interpolation between cells is not so good.</p>

<p>The new method with 1e3 is clearly struggling when the wind is coasting, because there is no appreciable change in v over a distance as small as 1e3cm.</p>

<p>Note also the level of ..'noise' in the new method at larger distances - I am not quite sure why this is happening but it suggests numerical/precision problems to me.</p>

<p>I am wondering if the best approach will be the new method but with a ds which is chosen according to the scale of the cell you are in- i.e. a fixed fraction of the cells extent or something. I can test this and will do so.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62613771" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="hc5WodO44lRaktJckkThur46ZOUETyKFJ3BQFGnMt86xktd7ndq2BjJipn0iena1/5nss/16b0bNass8bxhvFQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62613771-body" name="issue_comment[body]" tabindex="1">Ok, so I wrote a little bit of code which evaluated the relevant velocity gradient at a load of points along the 75 degree sightline. I did this for the old method, and also for the new method with a load of different values for ds when evaluating dvds (see code above).

This is for the fiducial AGN model. I am not sure why the turnover at ~3e16 happens- where rotational gradients start being dominated by poloidal? The acceleration length here is 1e18cm.

![dvds_variation](https://cloud.githubusercontent.com/assets/3007249/4999989/fd0be4fe-69b4-11e4-902f-4d5a315658f8.png)

The results are interesting. The old method does pretty badly near the base of the wind- presumably because the velocity field is fairly complex there and doing a linear interpolation between cells is not so good.

The new method with 1e3 is clearly struggling when the wind is coasting, because there is no appreciable change in v over a distance as small as 1e3cm.

Note also the level of ..'noise' in the new method at larger distances - I am not quite sure why this is happening but it suggests numerical/precision problems to me.

I am wondering if the best approach will be the new method but with a ds which is chosen according to the scale of the cell you are in- i.e. a fixed fraction of the cells extent or something. I can test this and will do so.

</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-62620469" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="44640f85e30b6c74786459315bb4a4af">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62620469" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62620469" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62620469" class="timestamp">
      <time datetime="2014-11-11T21:05:17Z" is="relative-time" title="Nov 11, 2014, 4:05 PM EST">a day ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">I agree it looks like a precision problem at large distances, though I find it a bit surprising when I think about the number of  significant figures in a double precision number.    I assume we are sure that everything is double precision.  You might want to check that this is the case, and also to check whether the calculation is being done in the best order.

It might also be worthwhile verifying what the value is agains the actual calculation for an SV or KWD model, I.e not using the values stored in the wind structure.

Knox</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62620469" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="hFBFNyxvrefxgmC2EDsTwVYbhBOfMPNzl/6MgXIRxcQE/w7oskblFIGfeIzjLQePR0zVaXwaKdbnqAZsNjtfnQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62620469-body" name="issue_comment[body]" tabindex="1">I agree it looks like a precision problem at large distances, though I find it a bit surprising when I think about the number of  significant figures in a double precision number.    I assume we are sure that everything is double precision.  You might want to check that this is the case, and also to check whether the calculation is being done in the best order.

It might also be worthwhile verifying what the value is agains the actual calculation for an SV or KWD model, I.e not using the values stored in the wind structure.

Knox</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62640518" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="c663a48e43a9f2ef785632f1cf5693e5">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62640518" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62640518" class="timestamp">
      <time datetime="2014-11-11T23:21:48Z" is="relative-time" title="Nov 11, 2014, 6:21 PM EST">23 hours ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Ok, so I'm not quite sure exactly why the jagged behaviour occurs, but it's definitely related to the fact that the routine vwind_xyz interpolates on the stored values of v for each cell (see plot below)</p>

<p>If you replace the calls in dvwind_ds to vwind_xyz with sv_velocity (a more complicated routine which finds the streamline and hence the velocity at the point) then the results look like this. This is a comparison of the new method, with ds set to 1e7, with both vwind_xyz and sv_velocity, and also includes the old method for good measure.</p>

<p><a href="./dvds_issue_files/f8220292-69ce-11e4-8262-e097da1509f7.png" target="_blank"><img src="./dvds_issue_files/f8220292-69ce-11e4-8262-e097da1509f7.png" alt="dvds_methodchecks" style="max-width:100%;"></a></p>

<p>So I'm glad I looked into this, because it's definitely not a case of new method good, old method bad. We could just continue to use the old method except in SPHERICAL coords, but then we're messing up the lowest part of the wind quite badly. </p>

<p>One might argue that this only happens over a cell or few, and we model that part of the wind poorly anyway. Conversely, that region is dense and could be important for absorption and emission, so getting the velocity gradient wrong there is perhaps not a very good idea - and the fact that the AGN spectrum appears to be affected a little perhaps suggests it is an important region (although I should check where the absorption occurs in those new features).</p>

<p>I'll look into this more tomorrow- right now I'm not entirely sure what the best course of action is.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62640518" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="iK+zysCSAs8ghnegT6XfsxUwXj7TkWTk3fQHU8w/L0FkhARpS5pnsdpzs9t5Y1Ge2fcEB7XsEiPMcOKfgQTXvg=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62640518-body" name="issue_comment[body]" tabindex="1">Ok, so I'm not quite sure exactly why the jagged behaviour occurs, but it's definitely related to the fact that the routine vwind_xyz interpolates on the stored values of v for each cell (see plot below)

If you replace the calls in dvwind_ds to vwind_xyz with sv_velocity (a more complicated routine which finds the streamline and hence the velocity at the point) then the results look like this. This is a comparison of the new method, with ds set to 1e7, with both vwind_xyz and sv_velocity, and also includes the old method for good measure.

![dvds_methodchecks](https://cloud.githubusercontent.com/assets/3007249/5002440/f8220292-69ce-11e4-8262-e097da1509f7.png)

So I'm glad I looked into this, because it's definitely not a case of new method good, old method bad. We could just continue to use the old method except in SPHERICAL coords, but then we're messing up the lowest part of the wind quite badly. 

One might argue that this only happens over a cell or few, and we model that part of the wind poorly anyway. Conversely, that region is dense and could be important for absorption and emission, so getting the velocity gradient wrong there is perhaps not a very good idea - and the fact that the AGN spectrum appears to be affected a little perhaps suggests it is an important region (although I should check where the absorption occurs in those new features).

I'll look into this more tomorrow- right now I'm not entirely sure what the best course of action is.


</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-62740896" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="13555dabe7734f325e0c9a5a501d42ce">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62740896" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62740896" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62740896" class="timestamp">
      <time datetime="2014-11-12T15:57:23Z" is="relative-time" title="Nov 12, 2014, 10:57 AM EST">6 hours ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">James, I thought about this problem overnight, and I have some ideas.

I think I know why some years ago why I adopted put velocity gradients into the code (by which I mean we estimate velocity gradients by bilinear interpolation of the pre-calculated velocity gradients at the edge).  I told you it was to do with concerns about speed but I now believe there was another more important reason.  I was concerned issues associated with continuity of parameters crossing grid cells.  Specifically, if we calculate the velocity gradient on the fly from the velocities at specific grid points, then when you cross a grid cell, you will have discrete jumps in the velocity gradient.  On the other hand, with the velocity gradients defined at the corners of the cells, then the velocity gradients will be continuous.

So in principle, I think the velocity gradient method is better.   Whether it matters or whether it is causing the problem at large radii is an interesting question.  The other possibility that occurred to me is that it is another manifestation of the precision problem.  If we only have one or two significant digits after the subtraction, I can imagine there would be jumps.   It could also be I guess an error in the code that does the bilinear interpolation, though this seems unlikely since that is what we use for everything.  One clue about what is actually going on might be obtained by looking at how things change on a very fine scale, within a single cell.

If it really is better to use the velocity gradient method, then we have to solve the problem in spherical coordinates.  I still believe the way to do this is to incorporate the proper rotations of the velocity gradient from the pre-calculated direction.  If we want to go this route, one way would be to compare the velocity gradients derived from the spherical grid to that in the spherical polar grid.

OK, that is.</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62740896" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="ZaD33CK0XS40hhBeQzcE8kIGYcV5v5wmiVPZVsl/hOv1wPe90thloZdogH51u7NcnU2Grc9M6bf1eWTsCSbQ5A=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62740896-body" name="issue_comment[body]" tabindex="1">James, I thought about this problem overnight, and I have some ideas.

I think I know why some years ago why I adopted put velocity gradients into the code (by which I mean we estimate velocity gradients by bilinear interpolation of the pre-calculated velocity gradients at the edge).  I told you it was to do with concerns about speed but I now believe there was another more important reason.  I was concerned issues associated with continuity of parameters crossing grid cells.  Specifically, if we calculate the velocity gradient on the fly from the velocities at specific grid points, then when you cross a grid cell, you will have discrete jumps in the velocity gradient.  On the other hand, with the velocity gradients defined at the corners of the cells, then the velocity gradients will be continuous.

So in principle, I think the velocity gradient method is better.   Whether it matters or whether it is causing the problem at large radii is an interesting question.  The other possibility that occurred to me is that it is another manifestation of the precision problem.  If we only have one or two significant digits after the subtraction, I can imagine there would be jumps.   It could also be I guess an error in the code that does the bilinear interpolation, though this seems unlikely since that is what we use for everything.  One clue about what is actually going on might be obtained by looking at how things change on a very fine scale, within a single cell.

If it really is better to use the velocity gradient method, then we have to solve the problem in spherical coordinates.  I still believe the way to do this is to incorporate the proper rotations of the velocity gradient from the pre-calculated direction.  If we want to go this route, one way would be to compare the velocity gradients derived from the spherical grid to that in the spherical polar grid.

OK, that is.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62767775" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="03f025331873b2b426d75f56f95b00e3">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62767775" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62767775" class="timestamp">
      <time datetime="2014-11-12T18:35:27Z" is="relative-time" title="Nov 12, 2014, 1:35 PM EST">3 hours ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Knox, I don't fully understand your comment. </p>

<p>The problem at large radii - the discrete jumps in the blue line - is in the 'on the fly' method, and only when you calculate dvds on the fly using the vwind_xyz routine, which finds velocity at a point x by doing a bilinear interpolation.</p>

<p>If you use the on the fly method but use the sv_velocity() routine you get the green curve- smoother behaviour at large distances that agrees with the smooth behaviour of the old method i.e. the interpolation on the velocity gradient tensor.</p>

<p>At small distances - within the first 30 cells or so of the disk- all three methods disagree. One might expect that the on-the-fly method with sv_velocity() gives the most accurate result (note this is also the slowest routine) in which case the other methods are off by a fairly large amount here. </p>

<p>So I think the old method of bilinear interpolation is clearly best at large distances in 2d coordinate systems. There are 2 problems to solve:</p>

<ul class="task-list">
<li>the bilinear interpolation method gives the wrong answers in spherical coords. 

<ul class="task-list">
<li>Solution: Can either use the on the fly method in spherical coords with an if statement, or do the correct rotation as Knox suggests. </li>
</ul>
</li>
<li>the bilinear interpolation method gives wrong, or at least different answers close to the disk. 

<ul class="task-list">
<li>Solution: I don't know!</li>
</ul>
</li>
</ul>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62767775" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="+eWSxfO87G8tN6GavD7bwvnun4oAJnimfzFw5Gzrj/YHab7DTy0YDsFiT1tSQ4aPQLAOGdAX9MfTrSmMft7F8A=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62767775-body" name="issue_comment[body]" tabindex="1">Knox, I don't fully understand your comment. 

The problem at large radii - the discrete jumps in the blue line - is in the 'on the fly' method, and only when you calculate dvds on the fly using the vwind_xyz routine, which finds velocity at a point x by doing a bilinear interpolation.

If you use the on the fly method but use the sv_velocity() routine you get the green curve- smoother behaviour at large distances that agrees with the smooth behaviour of the old method i.e. the interpolation on the velocity gradient tensor.

At small distances - within the first 30 cells or so of the disk- all three methods disagree. One might expect that the on-the-fly method with sv_velocity() gives the most accurate result (note this is also the slowest routine) in which case the other methods are off by a fairly large amount here. 

So I think the old method of bilinear interpolation is clearly best at large distances in 2d coordinate systems. There are 2 problems to solve:

* the bilinear interpolation method gives the wrong answers in spherical coords. 
    * Solution: Can either use the on the fly method in spherical coords with an if statement, or do the correct rotation as Knox suggests. 
* the bilinear interpolation method gives wrong, or at least different answers close to the disk. 
    * Solution: I don't know!</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>
  <div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>
    <div id="issuecomment-62795060" class="comment timeline-comment js-comment js-task-list-container collaborator-comment current-user is-task-list-enabled" data-body-version="fdf40e02e959638853ee41c118b9ee8e">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62795060" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">

    <strong>
      <a href="https://github.com/jhmatthews" class="author">jhmatthews</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62795060" class="timestamp">
      <time datetime="2014-11-12T21:17:33Z" is="relative-time" title="Nov 12, 2014, 4:17 PM EST">44 minutes ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body markdown-format js-comment-body">
          <p>Knox, this stuff about disagreeing at close distances is just a silly mistake on my part- the code is fine. I'd accidentally started the photon I was tracing off with a direction that mean it spent time outside the wind, and the check I wrote to check it was in the wind was also wrong...so in the region before ~3e16 the photon is travelling in empty space, so no wonder the calculation is completely different and wrong. Sorry about that...</p>

<p>This is what the actual plot should like that spends it's entire time in the wind:</p>

<p><a href="./dvds_issue_files/04b6c066-6a87-11e4-8203-0cce7e1678e3.png" target="_blank"><img src="./dvds_issue_files/04b6c066-6a87-11e4-8203-0cce7e1678e3.png" alt="dvds" style="max-width:100%;"></a></p>

<p>I'm pretty sure the jagged behaviour will be just be what you suspected about derivatives changing when  crossing cells but I'm checking that. </p>

<p>So that means we definitely want to keep the bilinear interpolation in general, but obviously this doesn't work in spherical 1d coordinates. I could just switch the method in spherical coords to use the on the fly method, but call model_velocity() instead of the vwind_xyz() routine - this avoids interpolating altogether and should give a smooth curve. I appreciate this approach is lazy because it avoids the problem I am finding hard of understanding how the interpolation method should translate to a 1d method.</p>

<p>I'll clean up all these comments when we decide what to do here.</p>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62795060" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="aVjmvV2IVYd2Y8ziXZGWVmoKfUJNw8F/K14pUTmpbkQezw4i2+eYs3xNplDorIR0AAnwFKQvdTAn9eyuPPt1EQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62795060-body" name="issue_comment[body]" tabindex="1">Knox, this stuff about disagreeing at close distances is just a silly mistake on my part- the code is fine. I'd accidentally started the photon I was tracing off with a direction that mean it spent time outside the wind, and the check I wrote to check it was in the wind was also wrong...so in the region before ~3e16 the photon is travelling in empty space, so no wonder the calculation is completely different and wrong. Sorry about that...

This is what the actual plot should like that spends it's entire time in the wind:

![dvds](https://cloud.githubusercontent.com/assets/3007249/5018694/04b6c066-6a87-11e4-8203-0cce7e1678e3.png)

I'm pretty sure the jagged behaviour will be just be what you suspected about derivatives changing when  crossing cells but I'm checking that. 

So that means we definitely want to keep the bilinear interpolation in general, but obviously this doesn't work in spherical 1d coordinates. I could just switch the method in spherical coords to use the on the fly method, but call model_velocity() instead of the vwind_xyz() routine - this avoids interpolating altogether and should give a smooth curve. I appreciate this approach is lazy because it avoids the problem I am finding hard of understanding how the interpolation method should translate to a 1d method.

I'll clean up all these comments when we decide what to do here.</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>



<!-- Rendered timeline since 2014-11-12 13:17:33 -->
<div class="timeline-comment-wrapper js-comment-container">
    <a href="https://github.com/kslong"><img alt="kslong" class="timeline-comment-avatar" data-user="2530901" height="48" src="./dvds_issue_files/2530901(1)" width="48"></a>
    <div id="issuecomment-62802373" class="comment timeline-comment js-comment js-task-list-container collaborator-comment is-task-list-enabled" data-body-version="38c4a851935d391aac0b670b745c8b89">

  <div class="timeline-comment-header ">

    <div class="timeline-comment-actions">
        <a class="timeline-comment-action js-comment-edit-button" data-skip-pjax="" href="https://github.com/agnwinds/python/issues/118#" title="Edit comment" aria-label="Edit comment">
          <span class="octicon octicon-pencil"></span>
        </a>
        <a class="timeline-comment-action delete-button js-comment-delete" data-remote="" data-method="delete" data-confirm="Are you sure you want to delete this?" href="https://github.com/agnwinds/python/issue_comments/62802373" title="Delete comment" aria-label="Delete comment">
          <span class="octicon octicon-x"></span>
        </a>
    </div>

    <span class="timeline-comment-label">Collaborator</span>


  <div class="timeline-comment-header-text">
      <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62802373" class="comment-type-icon octicon octicon-mail-read" title="This comment left via email reply."></a>

    <strong>
      <a href="https://github.com/kslong" class="author">kslong</a>
    </strong>

    commented

    <a href="https://github.com/agnwinds/python/issues/118#issuecomment-62802373" class="timestamp">
      <time datetime="2014-11-12T21:57:52Z" is="relative-time" title="Nov 12, 2014, 4:57 PM EST">4 minutes ago</time>
    </a>
  </div>
</div>


  <div class="comment-content">
      <p class="comment-form-stale">
        The content you are editing has changed. Reload the page and try again.
      </p>

    <div class="edit-comment-hide">
      <div class="comment-body markdown-body email-format js-comment-body">
          <div class="email-fragment">OK, this is good news.

 With respect to spherical models, if we take the “lazy” approach, I think we should close this issue, saying we have a reasonable approach since spherical models are not really what python was intended for, but open a new issue on the remaining problem.   I think it reasonable though to move on to other items at this point.

That said, I believe the solution is to figure out how the tensor ought to be rotated at the places where it intersects the cell boundaries, and you should then just interpolate, and I think we could verify what the rotation is by trying what I suggested earlier, but anyone who cares can just do a spherical model in polar coordinates (at some cost in computing)

Knox</div>
      </div>

    </div>

      <div class="context-loader">Sending request…</div>

<div class="form-content js-write-bucket js-suggester-container js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments/62802373" class="js-comment-update" data-remote="" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="/lc0Y9lHA5cyNJtgh9ftgZTvCihRFnMnteCVmPtdmA/+x2qzO0cMix9bJyTG0loLVTbCw7cBQ/tRfrr0E5BBMQ=="></div>

    <input type="hidden" name="context" value="">

    <textarea class="comment-form-textarea js-comment-field js-quick-submit js-task-list-field js-size-to-fit js-suggester-field" id="issuecomment-62802373-body" name="issue_comment[body]" tabindex="1">OK, this is good news.

 With respect to spherical models, if we take the “lazy” approach, I think we should close this issue, saying we have a reasonable approach since spherical models are not really what python was intended for, but open a new issue on the remaining problem.   I think it reasonable though to move on to other items at this point.

That said, I believe the solution is to figure out how the tensor ought to be rotated at the places where it intersects the cell boundaries, and you should then just interpolate, and I think we could verify what the rotation is by trying what I suggested earlier, but anyone who cares can just do a spherical model in polar coordinates (at some cost in computing)

Knox</textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>


    <div class="form-actions">

      <button class="button" type="submit" tabindex="1" data-disable-with="">Update comment</button>
      <button type="button" tabindex="1" class="button danger js-comment-cancel-button" data-confirm-text="Are you sure you want to cancel? You have unsaved changes that will be reverted.">
        Cancel
      </button>
    </div>

    <div class="suggester-container">
      <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
      </div>
    </div>
</form></div>

<div class="comment-form-error comment-form-bottom js-comment-update-error"></div>

  </div>
</div>

  </div>



<!-- Rendered timeline since 2014-11-12 13:57:52 -->
<div id="partial-timeline-marker" class="js-timeline-marker js-socket-channel js-updatable-content" data-channel="agnwinds/python:issue:44679748" data-url="/agnwinds/python/issues/118/show_partial?partial=timeline_marker&amp;since=1415829472" data-mark-as-read-url="/agnwinds/python/notifications/mark?ids=44556619" data-last-modified="Wed, 12 Nov 2014 21:57:52 GMT">
</div>


        </div>

        <div class="discussion-timeline-actions">
            
  
<div class="timeline-comment-wrapper timeline-new-comment js-comment-container ">
  <a href="https://github.com/jhmatthews"><img alt="James Matthews" class="timeline-comment-avatar" data-user="3007249" height="48" src="./dvds_issue_files/3007249(1)" width="48"></a>

  <form accept-charset="UTF-8" action="https://github.com/agnwinds/python/issue_comments" class="js-new-comment-form" data-remote="true" data-type="json" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="/ePPdxapzmFVSZOg/X6XeJ1QvkSygL1I1Sx5wjkqEpHFzDV9NzP5wjMsxDawFsOH/P3v73u/tLmC+MX4VMiyGQ=="></div>
    <div class="timeline-comment">
      <input type="hidden" name="issue" value="118">
        
<div class="js-previewable-comment-form js-suggester-container previewable-comment-form write-selected" data-preview-url="/preview?repository=7667591">
  <div class="comment-form-head tabnav">
    <ul class="tabnav-tabs">
      <li><a href="https://github.com/agnwinds/python/issues/118#" class="tabnav-tab write-tab js-write-tab selected">Write</a></li>
      <li><a href="https://github.com/agnwinds/python/issues/118#" class="tabnav-tab preview-tab js-preview-tab">Preview</a></li>
    </ul>
    <span class="tabnav-right">
      <a class="tabnav-widget text tabnav-extras" href="https://guides.github.com/features/mastering-markdown/" target="_blank">
        <span class="octicon octicon-markdown"></span>
        Markdown supported
      </a>
      
<a href="https://github.com/agnwinds/python/issues/118#fullscreen" class="enable-fullscreen js-enable-fullscreen tooltipped-n
  tabnav-widget text tabnav-extras">
  <span class="octicon octicon-screen-full"></span>
  Edit in fullscreen
</a>

    </span>
  </div>

  <div class="comment-form-error js-comment-form-error" style="display:none">    There was an error creating your Issue.
</div>
  <div class="write-content js-write-bucket js-uploadable-container js-upload-markdown-image upload-enabled is-default" data-upload-policy-url="/upload/policies/assets">
    <textarea name="comment[body]" tabindex="1" id="new_comment_field" placeholder="Leave a comment" class="input-contrast comment-form-textarea js-comment-field js-quick-submit js-size-to-fit js-quote-selection-target js-session-resumable js-suggester-field"></textarea>

      <p class="drag-and-drop">
    <span class="default">
        Attach images by dragging &amp; dropping,
        <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">selecting them</a>, or pasting
        from the clipboard.
    </span>
    <span class="loading">
      <img alt="" height="16" src="./dvds_issue_files/octocat-spinner-32.gif" width="16"> Uploading your images…
    </span>
    <span class="error bad-file">
      Unfortunately, we don't support that file type.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a PNG, GIF, or JPG.
      </span>
    </span>
    <span class="error too-big">
      Yowza, that's a big file.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with an image file smaller than 10MB.
      </span>
    </span>
    <span class="error empty">
      This file is empty.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again</a> with a file that's not empty.
      </span>
    </span>
    <span class="error bad-browser">
      This browser doesn't support image attachments.
      <span class="drag-and-drop-error-info">
        We recommend updating to the latest
        <a href="http://windows.microsoft.com/ie">Internet Explorer</a>,
        <a href="https://chrome.google.com/">Google Chrome</a>, or
        <a href="https://www.mozilla.org/firefox">Firefox</a>.
      </span>
    </span>
    <span class="error failed-request">
      Something went really wrong, and we can't process that image.
      <input type="file" multiple="multiple" class="manual-file-chooser js-manual-file-chooser">
      <span class="drag-and-drop-error-info">
        <a class="manual-file-chooser-text" href="https://github.com/agnwinds/python/issues/118#">Try again.</a>
      </span>
    </span>
  </p>

  </div>
  <div class="preview-content">
    <div class="comment">
  <div class="comment-content">
    <div class="comment-body markdown-body">
      <p>Nothing to preview</p>
    </div>
  </div>
</div>

  </div>

  <div class="suggester-container">
    <div class="suggester js-suggester js-navigation-container" data-url="/agnwinds/python/suggestions/issue/44679748">
    </div>
  </div>
</div>

        <div class="form-actions">
          <div id="partial-new-comment-form-actions" class="js-socket-channel js-updatable-content" data-channel="agnwinds/python:issue:44679748:state" data-url="/agnwinds/python/issues/118/show_partial?partial=form_actions">

  <button type="submit" class="button primary" tabindex="2" data-disable-with="" data-disable-invalid="">
    Comment
  </button>

    <button type="submit" name="comment_and_close" value="1" class="button js-comment-and-button" tabindex="3" data-comment-text="Close and comment" data-disable-with="">
    Close issue
  </button>

</div>


        </div>
    </div>
</form>
</div>


        </div>
      </div>

    </div>
    <div class="clear"></div>
  </div>

</div>


  
</div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="https://developer.github.com/">API</a></li>
      <li><a href="http://training.github.com/">Training</a></li>
      <li><a href="http://shop.github.com/">Shop</a></li>
      <li><a href="https://github.com/blog">Blog</a></li>
      <li><a href="https://github.com/about">About</a></li>

    </ul>

    <a href="https://github.com/" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
    </a>

    <ul class="site-footer-links">
      <li>© 2014 <span title="0.06651s from github-fe136-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy">Privacy</a></li>
        <li><a href="https://github.com/security">Security</a></li>
        <li><a href="https://github.com/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents js-suggester-field" placeholder=""></textarea>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="https://github.com/agnwinds/python/issues/118#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="https://github.com/agnwinds/python/issues/118#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w" aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="https://github.com/agnwinds/python/issues/118#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="./dvds_issue_files/frameworks-d11dde21d6ca6bcae359b045f5ff7a3524d353cc27e7c18e3386dfeb1222a1c0.js" type="text/javascript"></script>
      <script async="async" crossorigin="anonymous" src="./dvds_issue_files/github-dcb36b16030686d2c820f0138ee3fdb08dbc6fcbbe14bc242d91b96a75348c40.js" type="text/javascript"></script>
      
      
  


<div id="global-zeroclipboard-html-bridge" class="global-zeroclipboard-container" style="position: absolute; left: 0px; top: -9999px; width: 1px; height: 1px; z-index: 999999999;"><object id="global-zeroclipboard-flash-bridge" name="global-zeroclipboard-flash-bridge" width="100%" height="100%" type="application/x-shockwave-flash" data="https://assets-cdn.github.com/flash/ZeroClipboard.v2.1.6.swf"><param name="allowScriptAccess" value="always"><param name="allowNetworking" value="all"><param name="menu" value="false"><param name="wmode" value="transparent"><param name="flashvars" value="trustedOrigins=github.com%2C%2F%2Fgithub.com%2Chttps%3A%2F%2Fgithub.com&amp;swfObjectId=global-zeroclipboard-flash-bridge"></object></div>    <div class="facebox" id="facebox" style="display:none;">       <div class="facebox-popup">         <div class="facebox-content">         </div>         <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">           <span class="octicon octicon-remove-close"></span>         </button>       </div>     </div></body></html>